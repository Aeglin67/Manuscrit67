\chapter{Segmentation d'IRM f\oe tales \emph{in vivo}}
\label{chap:foetale}
\minitoc

Le but de ce chapitre est de présenter une méthode de segmentation du cortex d'un cerveau en maturation à partir d'IRM produites au cours de la grossesse.
Une nouvelle méthodologie est nécessaire car les méthodes de classification (notamment FCM) ne permettent pas d'obtenir une segmentation complète des tissus cérébraux (contrairement aux cas adultes).
Ce constat s'explique par les différences qui existent entre les IRM acquises dans le cas d'un adulte et celles acquises dans le cas d'un f\oe tus.
Ces différences sont de plusieurs ordres.

Tout d'abord, les protocoles d'acquisition entre ces deux types de cas sont assez différents, marqués notamment par un temps d'acquisition plus court dans le cas de du f\oe tus.
(A inclure : mise en avant des différences du point de vue de l'acquisition => Meriam)

Des différences sont également à signaler au niveau anatomique.
Un cerveau adulte est un cerveau mature, se présentant notamment avec un cortex très circonvolué et une matière blanche complètement myélinisée.
Dans un cas non mature, le cortex est une structure lisse où on peut observer la formation progressive des sillons.
De plus, la matière blanche n'est presque pas myélinisée.
Une autre différence anatomique est la présence d'une structure intermédiaire, la matrice germinale située autour des ventricules, où se forment les neurones avant leur migration vers le cortex.
Cependant, cette structure disparait presque complètement après 26 semaines de grossesse, mais des traces peuvent être observés après cette date.

% (Inclure une image IRM adulte et une image IRM enfant en T2 pour expliciter les différences de rendu + classification simple en trois classes).
Ces différences au niveau acquisition et anatomique conduisent nécessairement à des différences d'aspect à l'image.
La principale différence observable est l'étagement des intensités. 
Dans le cadre d'une IRM T2 adulte, de manière générale, la moyenne des intensité des différents tissus suit la répartion suivante : $\mathbf{v}_{LCR} > \mathbf{v}_{MG} > \mathbf{v}_{MB}$, tandis qu'elle suit la répartition suivante dans le cas d'une IRM f\oe tale : $\mathbf{v}_{LCR} > \mathbf{v}_{MB} > \mathbf{v}_{MG}$, ce qui est principalement due à l'absence de myélinisation de la matière blanche pendant la grossesse.
Dans le cadre d'une classification, l'effet de volume partiel (présence de plusieurs tissus dans un même voxel conduisant à une altération du signal) propre aux IRM conduit alors à des artefacts comme la présence d'une fine bande de voxels classés comme matière blanche entre le LCR et le cortex, ce qui est anatomiquement abérrant.
De plus, le faible temps d'acquisition des IRM f\oe tale conduit à une plus faible dissociabilité des tissus, marquée par un fort recouvrement des distributions en intensité des différents tissus, notamment le cortex et la matière blanche, tandis qu'en général, les tissus cérébraux adultes sont bien plus dissociables.

A la section~\ref{prenatal}, nous avons constaté que les réponses apportées aux différents problèmes posés par les IRM f\oe tales dans le cadre d'une segmentation complète des tissus conduisent à utiliser soit un atlas \cite{Habas:SPIE:2009, Habas:NeuroImage:2010} (dans le cadre d'une approche probabiliste) soit une étape spécifique de régularisation de la segmentation déconnectée des données avec quelques contraintes structurelles \cite{BachCuedra:MICCAI:2009}.
Cependant, l'utilisation d'un atlas pose le problème de sa construction et de son utilisation (notamment celui de son recalage sur le cas courant comme nous l'avons vu à la section \ref{subsec:atlas}) et une étape de régularisation déconnectée des données nécessite un réglage particulièrement fin des différents paramètres contrôlant la régularisation afin de ne pas s'éloigner de la réalité de l'image.

Notre méthode de segmentation reprend le principe d'une segmentation en plusieurs étapes (voir \cite{Dokladal:PR:2003} dans le cas d'une IRM adulte ou \cite{Ferrario:ESPC:2008, BachCuedra:MICCAI:2009} dans le cas d'une IRM f\oe tale), mais s'appuie essentiellement sur les données de l'image pour parvenir à une segmentation du cortex.
La méthodologie conduisant à cette segmentation est décrite à la section \ref{sec:foetus:methodo} et les résultats issus de cette méthodologie sont présentés à la section \ref{sec:foetus:validation}.

% Ce chapitre décrit une méthode de segmentation du cortex à partir d'images IRM f\oe tale.
% Etant donné les différences au niveau anatomique et de l'aspect des images entre les IRM adultes et les IRM f\oe tales, une nouvelle méthodologie a du être mise en place afin de prendre en compte les spécificités du cerveau des f\oe tus.
% 
% La méthode de segmentation doit prendre en compte les principales caractéristiques de ces images.
% Le modèle développé doit donc être adapté aux différents stades du développement cérébral et à l'aspect visuel des différents tissus.
% En effet, dans le cas d'une image pondérée en T2, nous pouvons observer que le cortex se présente sous la forme d'une bande sombre entre la MB et le LCR ($\mathbf{v}_{GM} < \mathbf{v}_{WM} < \mathbf{v}_{LCR}$), contrairement au cortex adulte dont l'intensité moyenne se situe entre celle du LCR et de la MB ($\mathbf{v}_{WM} < \mathbf{v}_{GM} < \mathbf{v}_{LCR}$ dans le cas d'une image pondérée en T2).
% Cette hyper-intensité de la matière blanche par rapport au cortex s'explique par l'absence de myéline à ce stade de la maturation cérébrale.
% L'inversion du contraste intervient dans les deux ans après la naissance avec la myélinisation, justifiant que certaines méthodes utilisées en segmentation néonatales soient proches de celles employées en segmentation f\oe tale.
% 
% Etant donné la faible dissociabilité des tissus, illustrée par l'impossibilité de distinguer les noyaux gris (matière grise interne) de la matière blanche, nous nous sommes concentrés sur la segmentation du cortex qui est une structure cérébrale mise en évidence sur les images IRM.
% L'objectif est d'obtenir une segmentation sans utiliser d'\emph{a priori} spatial sous forme d'atlas statistique. 
% En effet, l'utilisation d'un atlas peut s'avérer délicate à cause des problèmes de recalage de l'atlas vers les cas traités et aussi, les problèmes posés par la construction de l'atlas lui même. 
% 
% Comme préciser à la section~\ref{prenatal}, \cite{BachCuedra:MICCAI:2009} a défini une méthodologie permettant de réaliser une segmentation sans atlas.
% Cependant, cet algorithme utilise plusieurs phases de régularisation successives déconnectées des données, risquant d'obtenir un résultat peu pertinent malgré les contraintes anatomiques imposés.
% 
% La méthode de segmentation définie ici reprend le principe d'une segmentation en plusieurs étapes tout en tenant compte de connaissances anatomiques.
% Cependant, ces connaissances sont intégrées dans une approche proche des données plutôt que de contraindre une régularisation spécifique.

\section{Méthodologie}
\label{sec:foetus:methodo}

% \subsection{Notions de topologie}
\subsection{Motivations}

\begin{figure}[!thbp]

        \begin{center}
% 	\subfigure[]{\includegraphics[height=38mm]{eps/chapitre4/Brainweb_Noise_truth.eps}}
% 	\subfigure[]{\includegraphics[height=38mm]{eps/chapitre4/hist_pn9.eps}}\\
	\subfigure[]{\includegraphics[height=38mm]{eps/chapitre4/Truth_IBSR_12.eps}}
	\subfigure[]{\includegraphics[height=38mm]{eps/chapitre4/hist_IBSR_12.eps}}\\
	\subfigure[]{\includegraphics[height=38mm]{eps/chapitre4/TAB_Ar_Coronal_truth.eps}}
	\subfigure[]{\includegraphics[height=38mm]{eps/chapitre4/hist_foetus.eps}}
        \end{center}

        \caption[Comparatif entre la distribution en intensité dans une IRM T1 adulte et une IRM T2 f\oe tale]{\emph{Comparatif entre la distribution en intensité dans une IRM T1 adulte ( cas numéro 12 de la base IBSR) et une IRM T2 f\oe tale. Première ligne : vérité terrain issue de IBSR (a) et distribution en intensité associée (b). Deuxième ligne : vérité terrain d'une IRM f\oe tale (a) et distribution en intensité associée. Légende : LCR (rouge), matière grise (vert), matière blanche (bleu), tronc cérébral (jaune), cervelet (bleu ciel).}}

        \label{FIG:DISTRIB}

\end{figure}

L'analyse des images à partir des vérités-terrain (notamment l'analyse des histogrammes) montre des distributions d'intensité très différentes entre les IRM adultes et les IRM f\oe tales (voir la figure~\ref{FIG:DISTRIB}).
En effet, la distribution en intensité d'une IRM adulte révèle trois pics distincts correspondant respectivement au LCR, et aux matières grise et blanche.
La grande majorité des méthodes de segmentation des tissus cérébraux se sont appuyés sur cette propriété (en ajoutant éventuellement des classes intermédiaires pour tenir compte du volume partiel), tout en utilisant différentes contraintes (atlas, régularisation, topologie, \ldots) afin d'obtenir un résultat anatomiquement correct.

Cependant, l'observation de la distribution en intensité des IRM f\oe tales indique non seulement un important recouvrement entre le LCR et la matière blanche, mais montre également que la courbe représentant le cortex est presque entièrement inclue dans la courbe de la matière blanche.
Ce constat explique pourquoi les méthodes de classification classiques ne parviennent pas à obtenir de résultats satisfaisant sur ces images.
De manière générale, une classification (en trois classes ou plus) ne donne pas de résultats pertinents (comme illustré à la figure~\ref{FIG:CLASSIF:FOETUS}) et des artefacts de segmentation dus à l'effet de volume partiel apparaissent (par exemple, des voxels classés comme matière blanche entre le LCR externe et le cortex, ce qui est anatomiquement incorrect).

\begin{figure}[!t]
        
        \begin{center}
	\subfigure[]{\includegraphics[height=38mm]{eps/chapitre4/classif_original.eps}}
	\subfigure[]{\includegraphics[height=38mm]{eps/chapitre4/classif_2Class.eps}}
	\subfigure[]{\includegraphics[height=38mm]{eps/chapitre4/classif_3Class.eps}}
        \end{center}
        \caption[Illustration de clustering en deux et trois classes]{\emph{Illustration de clustering en deux et trois classes. (a) Image originale. (b) Clustering en deux classes. Légende ; Rouge : CSF, Vert : Cerveau. (c) Clustering en trois classes. Légende ; Rouge : CSF, Jaune : Matière blanche, Bleu : Matière grise.}\label{FIG:CLASSIF:FOETUS}}
        
        \begin{center}
	\subfigure[]{\includegraphics[height=34mm]{eps/chapitre4/Hist_Cortex1_3Class.eps}}
	\subfigure[]{\includegraphics[height=34mm]{eps/chapitre4/Hist_Cortex2_3Class.eps}}
	\subfigure[]{\includegraphics[height=34mm]{eps/chapitre4/Hist_Cortex3_3Class.eps}}
        \end{center}
        \caption[Comparaison entre les distributions d'intensité dans plusieurs zones d'intêrets construites par dilatation de la segmentation manuelle du cortex]{\emph{Comparaison entre les distributions d'intensité dans plusieurs zones d'intêrets construites par dilatation de la segmentation manuelle du cortex. (a) Dilatation d'un voxel. (b) Dilatation de deux voxels. (c) Dilatation de trois voxels. Légende : LCR (vert), matière grise (bleu), matière blanche (rouge).} \label{FIG:DISTRIB:CORTEX}}

\end{figure}

L'impossibilité de réaliser une segmentation directe des tissus cérébraux à partir de méthodes de clustering globale conduit nécessairement à la définition d'approches plus locales et progressives.
Dans cette idée, nous avons fait le choix d'une extraction du cortex car il s'agit de la structure qui apparait le mieux sur ces images, se présentant sous la forme d'une bande sombre entre la matière blanche et le LCR externe.
Une analyse de différentes zones d'intêrets construites autour du cortex révèle des distributions en intensité des différents tissus bien plus favorable à une opération de clustering (par $k$-means ou par FCM). 
Cependant, le recouvrement de ces distributions restent important, laissant penser que l'information d'intensité seule n'est pas suffisante, et le problème posé par l'effet de volume partiel (apparation de voxels classés comme matière blanche entre le LCR et le cortex) n'est pas résolu.
C'est pourquoi, l'introduction de contraintes géométriques est nécessaire pour contraindre l'évolution du processus et obtenir une segmentation finale anatomiquement cohérente.

Le principe de la méthode définie par la suite est donc le suivant.
Dans un premier temps, l'objectif est de construire une zone d'intêret incluant le cortex.
Cette étape est obtenue en séparant le LCR externe des ventricules et en construisant cette zone à partir de la frontière entre le LCR externe et le cerveau.
Dans un deuxième temps, le cortex est segmenter dans cette zone à partir de l'intensité des voxels et d'une information structurelle fournie par un filtre morphologique.

% L'impossibilité de réaliser une segmentation directe des tissus cérébraux a conduit à la définition d'une approche progressive reposant sur des connaissances anatomiques simples.
% Le cortex représentant une mince bande foncée entre le LCR externe et la matière blanche, une première étape consiste à extraire le LCR et à le séparer en LCR externe (LCR extérieur au cerveau) et ventricules.
% Une zone d'intêret incluant complètement le cortex est alors définie à partir de la frontière entre le cerveau et le LCR externe, afin de bénéficier d'une distribution d'intensité plus favorable aux algorithmes de classification.
% 
% Cependant, l'observation de ces distributions (voir la figure \ref{FIG:DISTRIB:CORTEX}) montre un important recouvrement entre la courbe de la matière blanche et celle de la matière grise.
% La segmentation finale du cortex est alors réalisée grâce à l'information combinée de l'intensité de l'image originale et d'un filtre morphologique permettant de mettre en valeur les parties minces et sombres de l'image.
% Ces deux étapes reposent sur une même méthode de segmentation définie à partir de l'algorithme $k$-means et incluant des contraintes géométriques afin de tenir compte des effets de volume partiel.

\subsection{$K$-means topologique}
\label{sec:kmeans:topo}

\begin{figure}[!t]

        \begin{center}
	\subfigure[]{\includegraphics[height=45mm]{eps/chapitre4/inhomogeneity2.eps} \label{FIG:KMEANS:BIAS}}
	\subfigure[]{\includegraphics[height=45mm]{eps/chapitre4/topologie.eps}}
        \end{center}

        \caption[Principes du $K$-Means topologique]{\emph{(a) Calcul des centroïdes locaux par interpolation des moyennes de région les plus proches. (b) Modèle topologique. Du blanc au gris foncé, les labels sont 0, 1, 2 et 3, 0 étant le fond de l'image. Le voxel 1 ne peut pas changer de label car il y a plus de 3 labels différents dans son voisinage. Le voxel 2 peut changer de label. Le voxel 3 ne peut pas changer car le fond fait parti de son voisinage.}}

        \label{FIG:KMEANS:PRINCIPLE}

\end{figure}

\begin{figure}[!t]

        \begin{center}
	\subfigure[]{\includegraphics[height=35mm]{eps/chapitre4/KMeans_Init.eps}\label{FIG:KMEANS:INIT}}
	\subfigure[]{\includegraphics[height=35mm]{eps/chapitre4/KMeans_Allowed1.eps}}
	\subfigure[]{\includegraphics[height=35mm]{eps/chapitre4/KMeans_Allowed2.eps}}\\
	\subfigure[]{\includegraphics[height=35mm]{eps/chapitre4/KMeans_NAllowed1.eps}}
	\subfigure[]{\includegraphics[height=35mm]{eps/chapitre4/KMeans_NAllowed2.eps}}
	\subfigure[]{\includegraphics[height=35mm]{eps/chapitre4/KMeans_NAllowed3.eps}}
        \end{center}

        \caption[Exemples de configurations finales autorisées ou non pour le $K$-Means topologique]{\emph{Exemples de configurations finales autorisées ou non pour le $K$-Means topologique. (a) Initialisation du modèle. (b) Configuration autorisée : les composantes du label 3 sont complètement incluses dans le label 2. (c) Configuration autorisée : les composantes du label 3 sont complètement incluses dans les composantes du label 2, elles mêmes incluses dans le label 1. (d) Configuration non autorisée : le label 3 est en contact avec le label 1. (e) Configuration non autorisée : le label 2 est en contact avec le fond de l'image. (f) Configuration non autorisée : le label 3 n'est pas complètement inclus dans le label 2. }}

        \label{FIG:KMEAN:ALLOWED}

\end{figure}

% Le but de cette section est de définir une méthodologie permettant de prendre en compte les contraintes anatomiques décrites plus haut.
Un modèle reposant sur trois cercles concentriques, chacun représentant une structure particulière, est défini. 
Il tient compte du biais en intensité et introduit des contraintes géométriques pour prendre en compte les problèmes dus au volume partiel.
Ce modèle est appelé le $k$-means topologique.

Rappelons tout d'abord que la segmentation par l'algorithme $k$-means est équivalente à la minimisation de la fonction coût suivante : 
\begin{equation}
J_{k\mbox{-}means} = \sum_{\mathbf{y}_{j} \in S_k} \sum_{k=0}^{K} \Vert \mathbf{y}_{j} - \mathbf{v}_{k} \Vert_2^{2},
\end{equation}
où $\mathbf{y}_{j}$ est l'intensité au voxel $j$, $\mathbf{v}_{k}$ est le centroïde de la classe $k$, $S_k$ est l'ensemble des voxels inclus dans la classe $k$ et $K$ est le nombre de classes recherchées.
Dans ce cas précis, la prise en compte de contraintes géométriques ne permet pas de suivre le shéma classique de minimisation de la fonction coût alternant évaluation des centroïdes des classes et classification des éléments de l'image en fonction de la distance par rapport aux centroïdes.
L'optimisation se fait selon un échange de voxels à la frontière des tissus, imposant un basculement d'un élément vers un autre si il respecte certains critères qui sont : 
\[
\left\{
\begin{array}{l}
\lvert C_{N_j} \rvert = 2 \mbox{, } \\ 
\forall \ c \in C_{N_j}, c \neq \mbox{ fond,} \\ 
\lVert \mathbf{y}_j - \mathbf{v}_{jk'} \rVert_{2} < \lVert \mathbf{y}_j - \mathbf{v}_{jk} \rVert_{2},
\end{array}
\right.
\]
où $N_j$ est un voisinage autour du voxel $j$, $C_{N_j}$ est l'ensemble des labels présents dans le voisinage $N_j$ et $c$ est un label.

Les deux premières conditions vérifient l'éligibilité d'un voxel au changement de label. 
Ce changement ne peut se faire que si exactement deux labels se trouvent dans le voisinage du voxel courant $j$ et si l'un de ces labels n'est pas le fond de l'image.
La première condition garantit que deux labels normallement non connexes ne partagent pas de frontière communes.
Les contraintes géométriques sont ainsi préservées.
De la même manière, la deuxième condition rend la labellisation des voxels voisins du fond de l'image invariante. 
La troisième condition permet la minimisation de la fonction coût.

La formulation des contraintes géométriques ne correspond pas exactement à celle des points simples car elle ne conserve pas la topologie des composantes connexes.
En effet, des tests préliminaires ont révélé que les points simples imposent une trop grande rigidité lors du processus de segmentation, bloquant l'évolution des différents labels.
Ces contraintes géométriques sont donc conçues de manière à laisser un label se séparer en plusieurs composantes (voir Figure~\ref{FIG:KMEAN:ALLOWED}), de manière respecter la réalité anatomique des structures que l'on cherche à segmenter (par exemple les ventricules dans le cas d'une segmentation 2D) et gagner ainsi en flexibilité.
De la même façon, la réunion de deux composantes est autorisée, comportement interdit par les points simples.
Néanmoins, les contraintes géométriques sont conservées (par exemple, un label complètement inclus dans un autre le restera même si il est divisé en plusieurs composantes).

% L'algorithme évolue donc selon un échange de voxels aux frontières de manière séquentielle.
% Chaque frontière est considérée l'une après l'autre.
% La convergence est atteinte lorsqu'aucun changement de label n'est effectué.

Tout comme l'algorithme FCM, le $k$-means ne prend pas en compte le biais en intensité présent dans les IRM.
Des centroïdes locaux $\mathbf{v}_{jk}$ sont donc introduits afin de prendre en compte cette réalité sans pour autant nécessiter de connaissance particulière sur ce biais.
Ils sont calculés de la façon suivante (voir la figure \ref{FIG:KMEANS:BIAS}) : 
\begin{enumerate}
\item Le domaine de l'image $\Omega$ est divisé en sous-volumes $r$,
\item Pour chaque sous-volume $r$ et pour chaque classe, une moyenne $\mathbf{v}_{rk}$ est calculée,
\item Chaque moyenne locale $\mathbf{v}_{jk}$ découle d'une interpolation des 4 (2D) ou 8 (3D) plus proches moyennes de région les plus proches (selon que l'image traitée soit reconstruite ou non). 
\end{enumerate}

En résumé, l'algorithme présenté ici suit le shéma d'optimisation suivant : 
\begin{enumerate}
\item Initialisation des labels (comme à la figure \ref{FIG:KMEANS:INIT}) et introduction d'un première évaluation des centroïdes (par exemple, par un clustering classique).
\item \'Evolution des labels selon un échange de voxels aux frontières de manière séquentielle en respectant les contraintes citées ci-dessus, jusqu'à ce qu'aucun changement ne soit enregistré.
\item \'Evaluation des centroïdes des classes, tel que décrit ci-dessus.
\item Répéter les étapes 2 et 3 jusqu'à convergence finale (c'est à dire, aucun changement enregistré après l'évaluation des centroïdes).
\end{enumerate}


% Les échanges de voxels aux frontières des tissus doivent respecter les conditions suivantes : 

% Cette formulation garantie l'invariance de la topologie en imposant le respect de l'intégrité des cercles concentriques et préserve les frontières du fond de l'image.

\subsection{Processus de segmentation}

\begin{figure}[!t]

        \begin{center}
% 	\subfigure[]{\includegraphics[height=45mm]{eps/chapitre4/inhomogeneity2.eps}}
	\includegraphics[height=45mm]{eps/chapitre4/process.eps}
        \end{center}

        \caption[Shéma du processus de segmentation]{\emph{Shéma du processus de segmentation. A partir de l'image originale, le $k$-means topologique permet de réaliser une segmentation séparant le LCR externe, le cerveau et les ventricules. A partir de la frontière entre le LCR externe et le cerveau, une zone d'intêret incluant le cortex est définie. Le cortex est alors segmenter par un $k$-means topologique incluant l'intensité des voxels ainsi qu'une image issue du filtrage \og Top-Hat \fg{} de l'image originale.}}

        \label{FIG:FOE:PROCESS}

\end{figure}

La méthode de segmentation du cortex se divise en deux phases distinctes, les deux utilisant le $k$-means topologique défini à la section précédente (voir le figure~\ref{FIG:FOE:PROCESS}).
La première étape consiste à extraire le cerveau tout en divisant le LCR en LCR externe et LCR interne.
Cela permet de définir la frontière entre le LCR externe et le cerveau, permettant ainsi de construire une zone d'intêret incluant le cortex.
La deuxième étape est la segmentation proprement dite du cortex au sein de cette zone d'intêret.

\subsubsection{Extraction du LCR}

\begin{figure}[!t]

        \begin{center}
	\subfigure[]{\includegraphics[height=30mm]{eps/chapitre4/process_LCR.eps}}\\
	\subfigure[]{\includegraphics[height=33mm]{eps/chapitre4/LCR_Init_Original.eps}}
	\subfigure[]{\includegraphics[height=33mm]{eps/chapitre4/LCR_Init_Distance.eps}\label{FIG:LCR:DISTANCE}}
	\subfigure[]{\includegraphics[height=33mm]{eps/chapitre4/LCR_Init_Init.eps}\label{FIG:LCR:INIT}}
	\subfigure[]{\includegraphics[height=33mm]{eps/chapitre4/LCR_Init_Final.eps}}
        \end{center}

        \caption[Segmentation LCR, Cerveau, Ventricules]{\emph{Séparation des ventricules et du LCR externe. (a) Shéma du processus. (b) Image Originale. (c) Carte de distance du volume intrâcranien. Les éléments en rouge sont les plus éloignés de la frontière du colume intracrânien. (d) Initialisation en fonction de la carte de distance. Le LCR externe est une bande d'un voxel d'épaisseur à la frontière du volume intracrânien. Les ventricules sont la région la plus au centre de ce volume et la limite est fixée à 80\% de la distance maximum. (e) Segmentation finale par le $k$-means topologique.}}

        \label{FIG:LCR:STEPS}

\end{figure}

Lors de cette étape, l'objectif est d'obtenir une séparation du LCR externe des ventricules, de manière à exploiter le frontière entre le LCR externe de le cerveau pour la segmentation du cortex.
Trois cercles concentriques représentant respectivement le LCR externe, le cerveau et les ventricules sont alors définis.

L'initialisation de ces trois cercles est réalisée par le biais d'une carte de distance intracrânienne, définie à partir d'une segmentation du volume intracrânien et mesurant le distance d'un voxel par rapport à la frontière extérieure de ce volume.
L'intêret de l'utilisation d'une carte de distance est qu'elle permet de positionner la région correspondant aux ventricules à une distance suffisante du LCR externe, de manière à ne pas créer de confusion entre ces deux labels.

% Cette phase nécessite de connaitre le volume intracrânien. 
% Celui ci peut être obtenu soit par une extraction automatique, soit par une segmentation manuelle.

% L'initialisation des labels est faite à partir d'une carte de distance intra-crânienne calculée depuis la surface extérieure du volume intracrânien (un voxel à $0$ signifie qu'il se situe hors de ce volume) (voir Figure \ref{FIG:LCR:DISTANCE}).
% Trois cercles concentriques sont alors définis à partir de cette carte de distance de manière à initialiser la segmentation et représentent respectivement : le LCR externe, le cerveau (matière blanche et matière grise) et le LCR interne (les ventricules).

Le LCR externe est initialisé comme une bande d'un voxel d'épaisseur à la frontière entre le volume intracrânien et le fond de l'image.
Cette initialisation permet à ce label de s'étendre depuis l'extérieur du volume intracrânien sur l'ensemble des voxels correspondant au LCR externe.
Les ventricules, correspondant à la sphère interne, ont une taille fixée à 80\% de la distance intracrânienne maximum de manière à prendre en compte la taille du crâne étudié (voir Figure \ref{FIG:LCR:INIT}).
Ce modèle évolue alors suivant la méthode de segmentation décrite à la section \ref{sec:kmeans:topo} avec l'image originale en entrée de l'algorithme.

\subsubsection{Extraction du cortex}
\label{pipe:cortex}

\begin{figure}[!t]

        \begin{center}
	\subfigure[]{\includegraphics[height=50mm]{eps/chapitre4/process_Cortex.eps}}\\
	\subfigure[]{\includegraphics[height=33mm]{eps/chapitre4/Cortex_Seg_Original.eps}}
	\subfigure[]{\includegraphics[height=33mm]{eps/chapitre4/Cortex_Seg_TopHat.eps}\label{FIG:CORTEX:TOPHAT}}
	\subfigure[]{\includegraphics[height=33mm]{eps/chapitre4/Cortex_Seg_Init.eps}\label{FIG:CORTEX:INIT}}
	\subfigure[]{\includegraphics[height=33mm]{eps/chapitre4/Cortex_Seg_Final.eps}}
        \end{center}

        \caption[Segmentation du cortex - Méthodologie]{\emph{Segmentation du cortex. (a) Schéma du processus. (b) Image originale. (c) En rouge, résultat du filtre \og Top-Hat \fg{} dans la zone d'intêret définie à partir de la frontière entre le LCR externe et le cerveau. (d) Zone d'intêret et initialisation des labels CSF, cortex et matière blanche. (e) Segmentation finale obtenue par le $k$-means topologique.}}

\end{figure}


\`A partir de la segmentation du LCR externe, une zone d'intêret incluant le cortex est construite de part et d'autre de la frontière entre le LCR externe et le cerveau.
Elle est représentée par une bande d'une épaisseur totale de 9 millimètres dont les deux premiers sont initialisés comme LCR, les cinq suivants comme cortex et les deux derniers comme matière blanche (voir Figure \ref{FIG:CORTEX:TOPHAT}).
Cette initialisation fût choisie car elle permet non seulement d'avoir une zone d'intêret incluant le cortex, mais permet également d'avoir une quantité de voxels de LCR et de matière blanche significative, de manière à pouvoir appliquer le $k$-means topologique.

Afin d'assurer la cohérence de la segmentation finale, les voxels classés comme ventricules sont éliminés de cette zone d'intêret, de même que les voxels appartenant au tronc cérébral et au cervelet.
Ces derniers sont supposés avoir été préalablement segmentés.
Etant donné que notre étude cherche une segmentation du cortex, nous nous sommes appuyés sur la vérité terrain pour restreindre la zone d'intêret.

Cependant, comme précisé précédemment, l'information fournie par l'intensité des voxels est insuffisante pour permettre l'extraction du cortex, même au sein de cette zone réduite.
Pour mettre en valeur le cortex, un opérateur de morphologie mathématique, le \emph{Top-Hat}~\cite{Najman:2010}, est donc utilisé.
Cet opérateur est défini de la manière suivante.
Soit $\varphi_{B}$ la fermeture morphologique de l'image $I$ par un élément structurant $B$.
Le filtre \emph{Top-Hat} est définit par la fonction : $T_d(I) = \varphi_B(I) - I$.
En d'autres termes, ce filtre révèle les zones sombres de l'image, ce qui correspond visuellement au cortex dans l'acquisition des IRM en pondération T2 (voir Figure \ref{FIG:CORTEX:TOPHAT}).
%  qui forme une bande sombre située entre le LCR externe et la matière blanche.

La segmentation est effectuée en exécutant l'algorithme $k$-means topologique avec deux entrées, que sont l'image originale et l'image filtrée par le \emph{Top-Hat}.
Ainsi, une classe est caractérisée par un vecteur de centroïdes $\mathbf{v}_{k}$, composée de la valeur moyenne issue de l'intensité des voxels $v_{k}^{I}$ et la valeur moyenne issue du filtre \emph{Top-Hat} $v_{k}^{TH}$ (on a donc $\mathbf{v}_{k} = (v_{k}^{I},v_{k}^{TH} )$),  permettant ainsi une meilleure discrimination du cortex.

\section{Validations}
\label{sec:foetus:validation}

% Les validations de cette méthodes de segmentation sont menées sur une base de 8 cas et son comportement est étudié aussi bien dans le cas d'image reconstruites que non-reconstruites.
La validation est menée aussi bien sur des images \og brutes \fg{} (c'est à dire non reconstruites) que sur des volumes reconstruits.
% L'extension de la méthodologie des données 2D à 3D est immédiate.

\subsection{Images non reconstruites}

\subsubsection{Caractéristiques et paramètres}

Les expériences sont menées sur huit cas acquis avec une machine IRM de 1.5 Tesla (Magnetom Avento, Siemens, Germany Erlangen) utilisant des séquences d'écho de spins ultra-rapides.
Chaque cas présente un ensemble de trois acquisitions correspondant respectivement aux images axiales, coronales et sagitales.
L'âge des différents f\oe tus s'étend de 27 à 32 semaines d'aménorrhée (SA). 
Le tableau~\ref{TAB:UNBUILD:CHARAC} résume les caractéristiques des images.

\begin{table}[!t]

\begin{center}

\begin{tabular}{|c|c|c|c|}
\hline
Cas & Coupe & Taille de l'image & Taille des voxels en mm\\
\hline
\hline
\multirow{3}*{Cas n\textdegree1} 
        & Axial & $512\times512\times19$ & $0.742\times0.742\times4.6$\\ \cline{2-4}
        & Coronal & $512\times512\times19$ & $0.742\times0.742\times4.6$\\ \cline{2-4}
        & Sagital & $512\times512\times19$ & $0.742\times0.742\times4.6$\\
\hline
\hline
\multirow{3}*{Cas n\textdegree2} 
        & Axial & $512\times512\times19$ & $0.742\times0.742\times4.6$\\ \cline{2-4}
        & Coronal & $512\times512\times19$ & $0.742\times0.742\times4.6$\\ \cline{2-4}
        & Sagital & $512\times512\times19$ & $0.742\times0.742\times4.6$\\
\hline
\hline
\multirow{3}*{Cas n\textdegree3} 
        & Axial & $512\times512\times20$ & $0.742\times0.742\times3.45$\\ \cline{2-4}
        & Coronal & $512\times512\times20$ & $0.742\times0.742\times3.45$\\ \cline{2-4}
        & Sagital & $512\times512\times17$ & $0.742\times0.742\times3.45$\\
\hline
\hline
\multirow{3}*{Cas n\textdegree4} 
        & Axial & $512\times512\times19$ & $0.742\times0.742\times3.45$\\ \cline{2-4}
        & Coronal & $512\times512\times19$ & $0.742\times0.742\times3.45$\\ \cline{2-4}
        & Sagital & $512\times512\times19$ & $0.742\times0.742\times3.45$\\
\hline
\hline
\multirow{3}*{Cas n\textdegree5} 
        & Axial & $512\times512\times19$ & $0.742\times0.742\times4.6$\\ \cline{2-4}
        & Coronal & $512\times512\times19$ & $0.742\times0.742\times4.6$\\ \cline{2-4}
        & Sagital & $512\times512\times19$ & $0.742\times0.742\times4.6$\\
\hline
\hline
\multirow{3}*{Cas n\textdegree6} 
        & Axial & $512\times512\times19$ & $0.742\times0.742\times4.6$\\ \cline{2-4}
        & Coronal & $512\times512\times19$ & $0.742\times0.742\times4.6$\\ \cline{2-4}
        & Sagital & $512\times512\times19$ & $0.742\times0.742\times4.6$\\
\hline
\hline
\multirow{3}*{Cas n\textdegree7} 
        & Axial & $512\times512\times19$ & $0.742\times0.742\times4.6$\\ \cline{2-4}
        & Coronal & $512\times512\times19$ & $0.742\times0.742\times4.6$\\ \cline{2-4}
        & Sagital & $512\times512\times19$ & $0.742\times0.742\times4.6$\\
\hline
\hline
\multirow{3}*{Cas n\textdegree8} 
        & Axial & $512\times512\times20$ & $0.742\times0.742\times3.45$\\ \cline{2-4}
        & Coronal & $512\times512\times17$ & $0.742\times0.742\times3.45$\\ \cline{2-4}
        & Sagital & $512\times512\times17$ & $0.742\times0.742\times3.45$\\
\hline
 
\end{tabular}
\caption[Caractéristiques des images utilisées lors de la validation (images non-reconstruites)]{\emph{Caractéristiques des images utilisées lors de la validation. L'importance de l'anistropie conduit à une segmentation orientée 2D.}\label{TAB:UNBUILD:CHARAC}}
\end{center}

\end{table}

Etant donné que ces images sont anisotropes, le $k$-means topologique évolue en deux dimensions et utilise un 4-voisinage pour l'évolution des différents labels. 
% (ou 8-voisinage par complément).
Les régions utilisées pour le calcul des moyennes de régions sont d'une taille $32\times32\times1$.
Ceci permet d'avoir un bon compromis entre la nécessaire représentation des différents tissus dans chaque sous-volume et la prise en compte de l'inhomogénéité de l'image.
L'élément structurant utilisé pour l'opérateur \emph{Top-Hat} est une cube de taille $5\times5\times1$, ce qui donne un cube de $3.71\times3.71\times3.45$ mm$^3$ (ou $3.71\times3.71\times4.6$ mm$^3$).
Le cortex se présentant sous la forme d'une mince bande sombre, cette taille est suffisante pour le mettre en avant par un filtre \og Top-Hat \fg{}.

Afin d'améliorer les performances de l'algorithme générale, un filtrage non-local est effectué en pré-traitement avec une zone de recherche de taille $11\times11\times3$ et des patchs de taille $3\times3\times1$ de manière à éliminer une partie du bruit présent dans les images.

\subsubsection{Résultats}

Chaque acquisition dispose d'au moins une segmentation manuelle réalisée par des experts médicaux servant de vérité terrain.
Dans les cas où plus d'une vérité terrain est disponible, une comparaison quantitative est effectuée entre ces vérités terrains de manière à évaluer le degré d'accord des experts entre eux.
Toutes les évaluations sont réalisées grâce au coefficient Dice défini à la section~\ref{sec:nlfcm:validations}.

\paragraph{Evaluation quantitative}

\begin{table}[!t]
\begin{center}

\begin{tabular}{|c|c|c|c|}
\hline
Cas (SA) & Coupe & Dice 3D & Dice maximum \\
\hline
\hline
\multirow{3}*{1(33)} 
        & Axial & 58.20 & 65.13\\ \cline{2-4}
        & Coronal & 58.55 & 68.64\\ \cline{2-4}
        & Sagital & 51.91 & 68.07\\
\hline
\hline
\multirow{3}*{2(28)} 
        & Axial & 65.20 & 77.77\\ \cline{2-4}
        & Coronal & 66.97 & 76.36\\ \cline{2-4}
        & Sagital & 61.90 & 74.14 \\
\hline
\hline
\multirow{3}*{3(30)} 
        & Axial & 56.14 & 75.20\\ \cline{2-4}
        & Coronal & 63.81 & 76.87\\ \cline{2-4}
        & Sagital & 52.07 & 69.06\\
\hline
\hline
\multirow{3}*{4(26)} 
        & Axial & 72.53 & 81.74\\ \cline{2-4}
        & Coronal & 72.01 & 82.15\\ \cline{2-4}
        & Sagital & 61.32 & 73.90\\
\hline
\hline
\multirow{3}*{5(34)} 
        & Axial & 53.51 & 61.54\\ \cline{2-4}
        & Coronal & 48.38 & 61.05\\ \cline{2-4}
        & Sagital & 43.94 & 55.32\\
\hline
\hline
\multirow{3}*{6(32)} 
        & Axial & 58.80 & 72.16\\ \cline{2-4}
        & Coronal & 61.04 & 74.90\\ \cline{2-4}
        & Sagital & 49.33 & 66.47\\
\hline
\hline
\multirow{3}*{7(-)} 
        & Axial & 46.89 & 57.68\\ \cline{2-4}
        & Coronal & 53.20 & 62.69\\ \cline{2-4}
        & Sagital & 45.97 & 59.77\\
\hline
\hline
\multirow{3}*{8(27)} 
        & Axial & 70.81 & 78.65\\ \cline{2-4}
        & Coronal & 66.17 & 74.31\\ \cline{2-4}
        & Sagital & 53.37 & 78.24\\
\hline
\hline
 \multirow{3}*{Moyenne $\pm$ écart-type} 
        & Axial & 60.26 $\pm$ 8.17 & -\\ \cline{2-4}
        & Coronal & 61.27 $\pm$ 7.22 & -\\ \cline{2-4}
        & Sagital & 48.79 $\pm$ 11.2 & -\\
\hline
\end{tabular}

\end{center}
\caption[Coefficients Dice issus de la segmentation du cortex (images non reconstruites)]{\emph{Coefficients Dice illustrant le recouvrement entre la vérité terrain et les segmentations automatiques. Coefficient global et coefficient maximum obtenue en effectuant une analyse coupe à coupe.}\label{TAB:DICE:UNBUILD}}
\end{table}

Le tableau~\ref{TAB:DICE:UNBUILD} fournit les résultats quantitatifs des différentes segmentations.
Les coefficients dice moyens pour chacune des trois orientations sont : 60.26 pour l'axiale, 61.27 pour la coronale et 48.79 pour la sagittale.
Nous pouvons constater que les résultats sont globalement similaires pour une segmentation d'images acquises selon les direction axiales et coronales, mais ils illustrent une mauvaise adéquation de la méthode avec la direction sagittale.

Ce constat est cependant peu surprenant, étant donné l'apparence des structures cérébrales vues dans une direction sagittale.
La zone du corps caleux est particulièrement inadaptée au modèle développé, tandis que les directions axiales et coronales sont adaptées au modèles.
Les valeurs des écarts-types montrent cependant une grande variabilité dans les résultats de la segmentation, qui peut s'expliquer largement par la qualité de l'image traitée (présence d'un bruit plus ou moins important, cortex plus ou moins net, présence d'un hypersignal au sein de la matière blanche, \ldots).

Une plus grande dispersion est observée dans la direction sagittale, confirmant la plus faible adéquation du modèle à cette direction, tandis que les résultats obtenus dans les directions axiales et coronales présentent une dispersion similaires.
L'ensemble des résultats quantitatifs tendent à montrer une meilleure adéquation du modèle aux directions coronale et axiale. 
Cependant, la valeur du coefficient Dice incite à une observation plus précise des résultats.

\paragraph{Evaluation qualitative}

\begin{figure*}[!t]
\centering
\subfigure[]{\includegraphics[height=40mm]{eps/chapitre4/TAB_Ar_Cortex_Truth.eps}} \label{cortex:truth}
\hspace{0.1mm}
\subfigure[]{\includegraphics[height=40mm]{eps/chapitre4/ESC_Mi_Cortex_Truth.eps}} \label{cortex2:truth}
\hspace{0.1mm}
\subfigure[]{\includegraphics[height=40mm]{eps/chapitre4/ARS_Hu_Cortex_Truth.eps}} \label{cortex3:truth}\\

% \vspace{-3mm}

\subfigure[]{\includegraphics[height=40mm]{eps/chapitre4/TAB_Ar_Cortex_Seg.eps} \label{cortex:final}}
\subfigure[]{\includegraphics[height=40mm]{eps/chapitre4/ESC_Mi_Cortex_Seg.eps} \label{cortex2:final}}
\subfigure[]{\includegraphics[height=40mm]{eps/chapitre4/ARS_Hu_Cortex_Seg.eps} \label{cortex3:final}}\\

% \vspace{-5mm}

\caption[Extraction du cortex (images non reconstruites)]{
\emph{Extraction du cortex. (a, b, c): vérités-terrains, (d, e, f) : régions d'intêret avec la segmentation finale. Rouge : LCR, vert : cortex, bleu : matière blanche et noyaux gris.}
\label{FIG:CORTEX:UNBUILD:VIEW}}
\vspace{-6mm}
\end{figure*}

La figure~\ref{FIG:CORTEX:UNBUILD:VIEW} présente les résultats de certaines segmentation en coupe axiale.
Elle confirme la pertinence du modèle proposé malgré une sous-segmentation dans certaines zones.
De manière générale, de moins bons résultats sont observés aux niveaux de la segmentation des coupes sagittales, comme attendu au vu des résultats quantitatifs.
La sous-segmentation est observée dans des zones ou le contraste entre le cortex et les tissus environnants est la moins prononcée, conduisant à une moins bonne efficacité du filtre \og Top Hat \fg{} pour révéler le cortex.

Dans le cas des images orientées dans la direction axiale, l'observation des résultats coupe à coupe montre une bonne adéquation du modèle à l'anatomie cérébrale dans la partie supérieure du cerveau, c'est à dire au dessus des troisièmes et quatrièmes ventricules.
En effet, ces ventricules sont reliés au LCR externe, introduisant une ambiguité quand à la localisation de la limite entre ventricules et LCR externe.
Les coupes supérieures permettent de distinguer nettement les ventricules du LCR externe, ce qui est compatible avec le modèle présenté.

Dans le cas des images orientées dans la direction coronale, l'observation des résultats coupe à coupe confirme la bonne adaptation du modèle à cette orientation.
En effet, dans la plupart des coupes, les ventricules sont séparés du LCR externe.
Cependant, une ambiguité est introduite là ou le quatrième ventricule rejoint le LCR externe, conduisant à sur-évaluer l'étendu de ce dernier et donc à définir une zone d'intêret trop large, provoquant l'apparition de faux positifs dans la segmentation, surtout dans la région autour du cervelet et du tronc cérébral.
% Cela s'explique par la non-adaptation du modèle à cette vue particulière, notamment concernant la zone entre les deux hémisphères cérébraux.



\paragraph{Evaluation croisée entre experts et segmentation manuelle}

Dans les cas où plusieurs segmentations manuelles sont disponibles pour un même cas, nous avons effectué une comparaison de ces segmentations afin d'évaluer la variabilité entre deux experts humains pour la segmentation d'une même structure.
Le tableau~\ref{TAB:DICE:UNBUILD:EXP} rapporte les résultats de cette comparaison ainsi que les coefficients Dice entre la segmentation automatique et les différentes segmentations manuelles.
Nous pouvons observer que les coefficients Dice mesurant le taux de recouvrement entre deux segmentations ont une valeur autour de 60\%, illustrant la variabilité existant entre deux experts pour l'évaluation du cortex.
Cet écart peut s'expliquer pour plusieurs raisons.
Nous pouvons évoquer la finesse d'une structure comme le cortex qui dans la plupart des cas a une épaisseur de quelques voxels seulement.
Enfin, il est difficile de décider d'une limite claire du cortex dans le cas de volume non-reconstruit. 
En effet, le volume partiel tend à réduire le contraste dans certaines zone, notamment les sillons, ce qui a pour effet de créer des discontinuités.
L'expert a alors toute latitude de faire figurer le cortex ou de considérer que la structure n'étant pas visible, elle ne doit pas figurer sur la segmentation manuelle.

L'étude des coefficients Dice entre la segmentation automatique et les segmentations manuelles montre une similarité avec les résultats de la comparaison des segmentations manuelles.
Dans certains cas, le coefficient Dice entre la segmentation automatique et un des deux experts est supérieur à celui mesurant la similarité entre les experts.
Cette variabilité des résultats illustre la difficulté d'obtenir une segmentation fiable du cortex, à partir d'IRM présentant une forte anisotropie (et donc un important effet de volume partiel) et une faible dissociabilité des tissus.

\begin{table}[!t]
\begin{center}

\begin{tabular}{|c|c|c|c|c|}
\hline
Cas (SA) & Coupe & Exp 1 - Exp 2 & Seg - Exp 1 & Seg - Exp 2\\
\hline
\hline
\multirow{3}*{3(30)} 
        & Axial & 61.10 & 63.64 & 56.14\\ \cline{2-5}
        & Coronal & - & - & -\\ \cline{2-5}
        & Sagital & 61.71 & 54.84 & 52.07\\
\hline
\hline
\multirow{3}*{4(26)} 
        & Axial & 68.21 & 72.53 & 59.81\\ \cline{2-5}
        & Coronal & 74.41 & 72.01 & 70.31\\ \cline{2-5}
        & Sagital & 68.73 & 61.32 & 60.25\\
\hline
\hline
\multirow{3}*{5(34)} 
        & Axial & 60.99 & 48.09 & 53.51\\ \cline{2-5}
        & Coronal & 56.82 & 48.38 & 49.35\\ \cline{2-5}
        & Sagital & 47.46 & 40.75 & 43.94\\
\hline
\hline
\multirow{3}*{6(32)} 
        & Axial & 60.97 & 65.84 & 58.80\\ \cline{2-5}
        & Coronal & - & - & -\\ \cline{2-5}
        & Sagital & 59.06 & 49.33 & 43.10\\
\hline
\end{tabular}
\caption[Comparaison croisées entre les segmentations manuelles et automatiques (images non reconstruites)]{\emph{Comparaison croisées entre les segmentations manuelles et automatiques : Expert 1 contre expert 2, segmentation automatique contre expert 1, segmentation automatique contre expert 2.}\label{TAB:DICE:UNBUILD:EXP}}
\end{center}
\end{table}

En conclusion, l'ensemble des résultats illustre néanmoins la possibilité d'obtenir une segmentation du cortex comparable à celle d'experts médicaux.
Cette segmentation est obtenue à partir d'une méthode mélant des connaissance anatomiques et des données structurelles afin d'obtenir une segmentation du cortex.
Cependant, l'effet de volume partiel ainsi que la faible dissociabilité des tissus rend la tache particulièrement difficile, même pour des experts.


\subsection{Images reconstruites}

L'intêret d'utiliser des images reconstruites est d'obtenir des segmentations de meilleures qualités et plus précise de manière à permettre une étude plus avancée des propriétés des tissus cérébraux chez le f\oe tus.
Ces images sont isotropes, permettant de réaliser une réelle segmentation en 3D et non coupe à coupe comme dans la section précédente.
Elles sont reconstruites en suivant la méthode de~\cite{Rousseau:MIA:2010} à partir de trois acquisitions respectivement axiale, coronale et sagitale.

\subsubsection{Caractéristiques et paramètres}

Pour cette étude, nous disposons de six cas.
% La méthode de reconstruction utilisée est celle de \cite{Rousseau:AR:2006}.
% Pour chaque cas, un volume 3D est reconstruit à partir d'acquisition dans trois directions différentes : axiale, coronale et sagittale.
Les images reconstruites ont pour dimensions $256\times256\times88$ à $256\times256\times117$ voxels.
La résolution des voxels est de $0.742\times0.742\times0.742$ mm$^3$.

Un 6-voisinage 3D est utilisé pour mettre en oeuvre l'algorithme de $k$-means topologique.
Empiriquement, un élément structurant de taille $5\times5\times5$ est utilisé pour l'opérateur \emph{Top-Hat}, ce qui correspond à cube de dimensions $3.71\times3.71\times3.71$ mm$^3$.
L'initialisation des différents labels, aussi bien à l'étape d'extraction du LCR qu'à l'étape de segmentation du cortex, est la même que pour les images non-reconstruites.

La segmentation du tronc cérébral et du cervelet consiste en la reconstruction des vérités-terrains issues des images non-reconstruites.
La vérité-terrain du cortex est obtenue par une segmentation manuelle.

\subsubsection{Résultats}

L'évaluation de l'algorithme de segmentation est effectuée par une comparaison entre une segmentation manuelle du cortex servant de vérité terrain et le résultat de la segmentation automatique.
L'influence de l'initialisation du cortex est testée afin de montrer la convergence de l'algorithme.
Les résultats correspondants à cette étude de la convergence sont montrés à la figure~\ref{FIG:CORTEX:BUILD:INIT}.
Cette figure présente deux courbes correspondant respectivement à l'évolution du coefficient de similarité Dice lors de l'initialisation de l'algorithme en fonction de l'épaisseur initiale du cortex, et l'évolution du coefficient mesurant la similarité de la segmentation finale en fonction de cette épaisseur.
Une épaisseur initiale de $3$ ou $4$ mm présente un coefficient Dice relativement élévé (autour de 68\%), ce qui n'entraine pas un gain très significatif lors du processus de segmentation (Dice autour de $75$\%).
Cependant, une initialisation à $2$ ou $5$ mm présente une plus faible similarité avec la vérité terrain, mais la valeur finale reste très proche de celle obtenue avec une initialisation à $4$ mm.
Ainsi, le coefficient Dice passe d'environ $48$\% à environ $72$\% dans le cas d'une initialisation à $2$ mm d'épaisseur.
Ces résultats illustrent une faible sensibilité à l'initialisation de l'algorithme de segmentation.

Le tableau~\ref{TAB:CORTEX:BUILD} montre les résultats de la segmentation sur chacun des cas traités, ainsi que la moyenne des coefficients Dice et l'écart-type.
Une sensible amélioration par rapport à la segmentation des images non-reconstruites est notable.
En effet, la moyenne des coefficients de similarité est bien plus élévée que dans le cas d'images non reconstruites (au mieux $61$\% contre environ $75$\%) avec une dispersion bien plus réduite (au mieux $7$\% contre environ $2$\%).
Ceci peut s'expliquer par les effets de l'algorithme de reconstruction qui tend à corriger les imperfections de l'image (correction du bruit, du biais et de certains artefacts de mouvement).
De plus, le traitement d'un volume 3D tend à réduire le problème présenté par l'épaisseur des coupes des images non-reconstruites, notamment un effet de volume partiel plus important. 
Des détails supplémentaires sur le cortex sont disponibles et permettent de mieux conduire la segmentation.

La figure~\ref{FIG:CORTEX:BUILD:VIEW} présente une illustration des résultats de la segmentation. 
Un phénomène de sous-segmentation est toujours visible sur certaines parties de l'image, mais l'apport des contraintes géométriques est bien mis en évidence par l'absence d'erreurs dues aux effets du volume partiel (présence de matière blanche entre le LCR et le cortex).
Aucune discontinuité du cortex n'est observée, ce qui favorise le processus de segmentation de cette structure.
Cette continuité permet d'observer une meilleure prise en compte des sillons et d'envisager leur suivi au cours de la grossesse.
Cependant, de même que pour les images non-reconstruites, les contraintes géométriques imposées par le modèles conduisent à la présence de faux positifs pour la segmentation du cortex.
Ce phénomène est particulièrement visible dans la région du cerveau ou le tronc cérébrale rejoint le corps calleux.
Le principale problème est toujours une séparation des ventricules du LCR externe qui peut être aléatoire et à l'absence de critères permettant de diminuer la probabilité d'apparition de voxels classés comme cortex dans cette zone.

\begin{figure}[!tb]
\centering
\includegraphics[height=38mm]{eps/chapitre4/performance.eps}
% \vspace{-4mm}
\caption[Comparaison des coefficients Dice moyens en fonction de l'épaisseur de l'initialisation du cortex]{\emph{Comparaison des coefficients Dice moyens en fonction de l'épaisseur de l'initialisation du cortex. Rouge : coefficient Dice de l'initialisation. Bleu : coefficient Dice de la segmentation finale.}\label{FIG:CORTEX:BUILD:INIT}}
% \vspace{-3mm}
\end{figure}

\begin{figure}[!tb]
\centering
\subfigure[]{\includegraphics[height=39mm]{eps/chapitre4/axial_3D_truth.eps}} \label{axial:truth}
\subfigure[]{\includegraphics[height=39mm]{eps/chapitre4/HER_Au_3D_truth.eps} \label{axial2:truth}}
\subfigure[]{\includegraphics[height=39mm]{eps/chapitre4/DER_An_3D_truth.eps} \label{case3:truth}}\\
% \hspace{0.1mm}
\subfigure[]{\includegraphics[height=39mm]{eps/chapitre4/axial_3D_seg.eps}} \label{axial:seg}
\subfigure[]{\includegraphics[height=39mm]{eps/chapitre4/HER_Au_3D_seg.eps} \label{axial2:seg}}
\subfigure[]{\includegraphics[height=39mm]{eps/chapitre4/DER_An_3D_seg.eps} \label{axial3:seg}}\\

\caption[Segmentation du cortex (images reconstruites)]{
\emph{Segmentation du cortex. (a,b,c) Segmentation manuelle. (d,e,f) Segmentation automatique. Légende ; rouge : LCR, vert : cortex, bleu : matière blanche et noyaux gris.}
\label{FIG:CORTEX:BUILD:VIEW}}
% \vspace{-6mm}
\end{figure}

\begin{table}[t]

\begin{center}
\small{
% \small
\begin{tabular}{|c|c|c|c|c|c|c|c|}
\hline
Cas (GA) & 1 (28) & 2 (30) & 3 (26) & 4 (32) & 5 (27) & 6 (30) & Moyenne $\pm$ écart-type\\
\hline
% $Sen$ & 77.83 & 80.61 & 77.78 & 78.61 & 86.29 & 78.84\\
% \hline
% $Sen$ with regularization & 80.19 & 82.79 & 74.08 & 72.69 & 85.45 & 75.59\\
% \hline
$Dice$ & 72.42 & 73.03 & 77.57 & 74.51 & 76.60 & 76.61 &  75.12 $\pm$ 1.93\\
% \hline
% \hspace{1mm} $DSC$ with regularization  \hspace{1mm} & 71.02 & 71.37 & 77.76 & 71.86 & 75.78 & 75.23\\
\hline
\end{tabular}
}
\end{center}
% \vspace{-2mm}
\caption[Coefficients Dice entre les vérités terrains et la segmentation automatique (images reconstruites)]{\emph{Coefficients Dice entre les vérités terrains et la segmentation automatique.}\label{TAB:CORTEX:BUILD}}
% \vspace{-10mm}
\label{tab:coronal:overlap}

\end{table}

Ces résultats sont donc des résultats préliminaires confirmant la possibilité de segmenter le cortex de manière fiable malgré l'absence d'\emph{a priori} issus d'un atlas ou d'une étape de régularisation spécifique. 
Ils ouvrent la voie à une segmentation des tissus par l'utilisation d'\emph{a priori} anatomiques.

Cependant, comme précisé à la section \ref{pipe:cortex}, cette méthodologie s'appuie sur une segmentation préalable du tronc cérébrale et du cervelet, ainsi qu'une extraction du volume intracrânien.
Une méthode d'extraction automatique du volume intracrânien, basée sur des opérateurs de morphologie mathématique, existe~\cite{Anquez:ISBI:2009} et la séparation des deux hémisphères et du cervelet est une opération déjà réalisée dans des cas adultes, qui pourrait être adaptée aux images reconstruites en IRM f\oe tale.

\section{Conclusion}

Ce chapitre a présenté une méthode de segmentation du cortex en IRM f\oe tale.
Le principe est d'utiliser des \emph{a priori} anatomiques génériques sous forme de contraintes géométriques et de s'appuyer exclusivement sur les données de l'images pour obtenir la segmentation finale.
Les résultats obtenus montrent la pertinence de cette approche, notamment dans le cadre de cas bénéficiant de la reconstruction d'un volume 3D à partir des acquisitions originales.

Cependant, plusieurs limitations ne permettent pas d'utiliser cet algorithme en routine clinique ou pour des études de population.
En effet, les coefficients de similarité obtenus, malgré leurs valeurs encourageantes, ne sont pas encore suffisamment élévés pour satisfaire à ce genre de travaux.
Les causes en sont en partie les contraintes géométriques du modèle, qui malgré leur apport dans la correction du volume partiel, introduisent des faux positifs dans la détection du cortex dans d'autres zones du cerveau.
Ceci démontre que des \emph{a priori} supplémentaires sont nécessaires afin de mieux orienter le processus de segmentation.
Des méthodes formalisant les relations spatiales entre différents objets et exprimant leur position relative de façon floue existent et semblent tout indiquer pour être introduit dans le processus de segmentation.

De plus, comme dit précédemment, cette méthodologie s'appuie sur une extraction préalable du volume intracranien et sur la segmentation du cervelet et du tronc cérébrale.
La définition d'un outil d'extraction de ces structures est donc indispensable dans la perspective d'obtenir un processus de segmentation complet des structures cérébrales.
