\chapter{Segmentation d'IRM f\oe tales \emph{in vivo}}
\label{chap:foetale}
\minitoc

Le but de ce chapitre est de présenter une méthode de segmentation du cortex cérébral à partir d'images IRM acquises au cours de la grossesse.
Les méthodes de segmentation développées pour les cas adultes ne permettent pas d'obtenir une segmentation complète des tissus cérébraux dans le cas f\oe tal, une voie alternative doit être explorée.
Plusieurs différences entre ces deux types d'images IRM expliquent notamment ce constat.

Tout d'abord, les protocoles d'acquisition sont assez différents, et marqués notamment par un temps d'acquisition plus court dans le cas du f\oe tus, rendu nécessaire afin d'éviter des artéfacts de mouvements lors de l'examen.
Des voxels anisotropes, c'est-à-dire présentant une longueur plus grande dans une direction que dans les deux autres, sont alors définis (les caractéristiques des images utilisées sont décrites plus en détails en Section~\ref{subsubsec:foetus:param}), de manière à obtenir un rapport signal à bruit favorable, entraînant un important effet de volume partiel.

Des différences sont également à signaler au niveau anatomique.
Un cerveau adulte est constitué d'un cortex très circonvolué et d'une matière blanche complètement myélinisée.
Dans un cas non mature, le cortex est une structure se plissant progressivement (lisse à 26 semaines de grossesse et très circonvolué à 32 semaines) où l'on peut observer la formation progressive des sillons.
Concernant la matière blanche, la myélinisation apparaît autour de la vingt-cinquième semaine au niveau les pédoncules cérébraux inférieurs et se propage aux colliculi inférieurs, au cervelet postérieur et aux noyaux ventro-latéraux du thalamus \cite{Rutherford:2001}.
Par la suite, aucune progression de la myélinisation n'est observée au cours de la période allant de la vingt-huitième à la quarantième semaine, la matière blanche restant principalement composée d'eau, ce qui entraîne un temps de relaxation T2 plus important et un signal plus élevé si l'image acquise est pondérée en T2.
Une autre différence anatomique est la présence d'une structure intermédiaire, la matrice germinale située autour des ventricules, où se forment les neurones avant leur migration vers le cortex.
Cependant, cette structure disparaît presque complètement après 26 semaines de grossesse, mais des traces peuvent être observées après cette date.

Ces différences au niveau de l'acquisition et de l'anatomie conduisent à des changements importants du contenu des images.
Le plus notable est l'inversion des contrastes entre la matière blanche et la matière grise par rapport à une image adulte (le cortex apparaît plus sombre que la matière blanche dans  le cas adulte pondéré en T1 et également plus sombre dans le cas d'une image IRM f\oe tale pondérée en T2) (voir en Figure~\ref{FIG:DISTRIB}).
Dans le cadre d'une classification, l'effet de volume partiel (présence de plusieurs tissus dans un même voxel conduisant à une altération du signal) propre aux IRM conduit alors à des artéfacts tels que la présence d'une fine bande de voxels classés comme matière blanche entre le LCR et le cortex, ce qui n'est pas pertinent d'un point de vue anatomique (voir Figure~\ref{FIG:CLASSIF:FOETUS}).
% De plus, le faible temps d'acquisition des IRM f\oe tales conduit à une plus faible dissociabilité des tissus, marquée par un fort recouvrement des distributions en intensité des différents tissus, notamment le cortex et la matière blanche, tandis qu'en général, les tissus cérébraux adultes sont bien plus dissociables.

En section~\ref{prenatal}, nous avons constaté que les réponses apportées aux différents problèmes posés par les IRM f\oe tales dans le cadre d'une segmentation complète des tissus, conduisent à utiliser soit un atlas \cite{Habas:SPIE:2009, Habas:NeuroImage:2010} (dans le cadre d'une approche probabiliste) soit une étape spécifique de régularisation de la segmentation déconnectée des données avec quelques contraintes structurelles \cite{BachCuedra:MICCAI:2009}.
Cependant, l'utilisation d'un atlas pose le problème de sa construction et de son utilisation (notamment celui de son recalage sur le cas courant comme nous l'avons vu en section \ref{subsec:atlas}) et une étape de régularisation, fondée sur une carte de segmentation préalablement estimée sans se référer à l'intensité des voxels, nécessite un réglage particulièrement fin des différents paramètres contrôlant la régularisation afin de ne pas s'éloigner de la réalité de l'image.

La méthode de segmentation décrite par la suite reprend le principe d'une segmentation en plusieurs étapes (voir \cite{Dokladal:PR:2003} dans le cas d'une IRM adulte ou \cite{Ferrario:ESPC:2008, BachCuedra:MICCAI:2009} dans le cas d'une IRM f\oe tale), mais s'appuie essentiellement sur l'intensité des voxels pour parvenir à une segmentation du cortex.
La méthodologie conduisant à cette segmentation est décrite en section \ref{sec:foetus:methodo} et les résultats issus de cette méthodologie sont présentés en section \ref{sec:foetus:validation}.

\section{Méthodologie}
\label{sec:foetus:methodo}

\subsection{Motivations}

\begin{figure}[!t]

        \begin{center}
% 	\subfigure[]{\includegraphics[height=38mm]{eps/chapitre4/Brainweb_Noise_truth.eps}}
	\subfigure[]{\includegraphics[height=38mm]{eps/chapitre4/IBSR_12.eps}}
	\subfigure[]{\includegraphics[height=38mm]{eps/chapitre4/IBSR_12_Truth.eps}}
	\subfigure[]{\includegraphics[height=38mm]{eps/chapitre4/hist_IBSR_12.eps}}\\
	\subfigure[]{\includegraphics[height=38mm]{eps/chapitre4/TAB_Ar_01_Coronal.eps}}
	\subfigure[]{\includegraphics[height=38mm]{eps/chapitre4/TAB_Ar_01_Coronal_Truth.eps}}
	\subfigure[]{\includegraphics[height=38mm]{eps/chapitre4/hist_foetus.eps}}
        \end{center}

        \caption[Comparatif entre les distributions en intensité dans une IRM T1 adulte et une image IRM T2 f\oe tale]{\emph{Comparatif entre les distributions en intensité dans une IRM T1 adulte (cas numéro 12 de la base IBSR) et une IRM T2 f\oe tale. Première ligne : image originale issue de IBSR (a), vérité-terrain correspondante (b) et distribution en intensité associée (c). Deuxième ligne : image originale d'une IRM f\oe tale (a), vérité-terrain associée (b) et distribution en intensité associée (c). Légende : LCR (rouge), matière grise (vert), matière blanche (bleu), tronc cérébral (jaune), cervelet (bleu ciel).}}

        \label{FIG:DISTRIB}

\end{figure}

L'analyse des histogrammes des images met en évidence des distributions d'intensité très différentes entre les images IRM adultes et les images IRM f\oe tales (voir Figure~\ref{FIG:DISTRIB}).
En effet, la distribution en intensité d'une IRM adulte révèle trois pics distincts correspondant respectivement au LCR et aux matières grise et blanche.
La grande majorité des méthodes de segmentation des tissus cérébraux se sont appuyées sur cette propriété (en ajoutant éventuellement des classes intermédiaires pour tenir compte du volume partiel), tout en utilisant différentes contraintes (atlas, régularisation, topologie, \ldots) afin d'obtenir un résultat anatomiquement correct (voir Sections~\ref{subsec:classif} et \ref{sec:fcm}).

Cependant, l'observation de la distribution en intensité des IRM f\oe tales indique non seulement un important recouvrement entre le LCR et la matière blanche, mais montre également que la distribution du cortex est presque entièrement incluse dans celle de la matière blanche.
Ce constat explique pourquoi les méthodes de classification classiques, fondées sur un partitionnement des intensités, ne parviennent pas à obtenir des résultats satisfaisants sur ces images.
De manière générale, une classification (en trois classes ou plus) ne donne pas de résultats pertinents (comme illustré en Figure~\ref{FIG:CLASSIF:FOETUS}).
En effet, la classification rend surtout compte des variations en intensité dans la matière blanche et des artéfacts de segmentation dus à l'effet de volume partiel apparaissent (par exemple, des voxels classés comme matière blanche entre le LCR externe et le cortex).

\begin{figure}[!t]
        
        \begin{center}
	\subfigure[]{\includegraphics[height=38mm]{eps/chapitre4/classif_original.eps}}
	\subfigure[]{\includegraphics[height=38mm]{eps/chapitre4/classif_2Class.eps}}
	\subfigure[]{\includegraphics[height=38mm]{eps/chapitre4/classif_3Class.eps}}
        \end{center}
        \caption[Illustration de partitionnements en deux et trois classes]{\emph{Illustration de partitionnements en deux et trois classes. (a) Image originale. (b) Partitionnement en deux classes. Légende : CSF (rouge), cerveau (vert). (c) Partitionnement en trois classes. Légende : CSF (rouge), matière blanche (jaune), matière grise (bleu). On peut observer l'apparition d'une mince bande de voxels classés en matière blanche entre la région classée comme LCR et la région classée comme matière grise. La classification prend surtout en compte les variations d'intensité dans la matière blanche.}\label{FIG:CLASSIF:FOETUS}}
        
        \begin{center}
	\subfigure[]{\includegraphics[height=34mm]{eps/chapitre4/Hist_Cortex1_3Class.eps}}
	\subfigure[]{\includegraphics[height=34mm]{eps/chapitre4/Hist_Cortex2_3Class.eps}}
	\subfigure[]{\includegraphics[height=34mm]{eps/chapitre4/Hist_Cortex3_3Class.eps}}
        \end{center}
        \caption[Comparaison entre les distributions d'intensité dans plusieurs zones d'intérêt construites par épaississement de la segmentation manuelle du cortex]{\emph{Comparaison entre les distributions d'intensité dans plusieurs zones d'intérêt construites par dilatation de la segmentation manuelle du cortex. (a) Dilatation d'un voxel. (b) Dilatation de deux voxels. (c) Dilatation de trois voxels. Légende : LCR (vert), matière grise (bleu), matière blanche (rouge).} \label{FIG:DISTRIB:CORTEX}}

\end{figure}

L'impossibilité de réaliser une segmentation directe des tissus cérébraux à partir de méthodes de partitionnement global nous a conduit à la définition d'approches plus locales et progressives, c'est-à-dire extraire les tissus un à un dans un volume de recherche plus réduit.
Suivant cette idée, nous nous sommes tournés vers une extraction du cortex, indicateur du degré de maturité cérébrale comme précisé au Chapitre~\ref{chap:ImageEtAnatomie}, qui se présente sous la forme d'une bande sombre entre la matière blanche et le LCR externe.
Une analyse de différentes zones d'intérêt construites autour du cortex révèle des distributions en intensité des différents tissus plus favorable à une opération de partitionnement (par les K-moyennes ou par FCM), trois pics distincts apparaissant sur l'histogramme des intensités. 
Cependant, le recouvrement de ces distributions reste important (voir Figure~\ref{FIG:DISTRIB:CORTEX}), laissant penser que l'information d'intensité seule n'est pas suffisante, et le problème posé par l'effet de volume partiel (apparition de voxels classés comme matière blanche entre le LCR et le cortex) n'est pas résolu.
L'introduction de contraintes géométriques est alors nécessaire pour guider l'évolution du processus et obtenir une segmentation finale anatomiquement cohérente.

Le principe de la méthode définie par la suite est le suivant.
Dans un premier temps, l'objectif est de construire une zone d'intérêt incluant le cortex.
Cette zone est obtenue à partir de la frontière entre le LCR et le cerveau, cette dernière étant mise en évidence par une séparation du LCR externe et des ventricules.
Dans un deuxième temps, le cortex est segmenté dans la zone d'intérêt à partir de l'intensité des voxels et d'une information structurelle fournie par un filtre morphologique.

\subsection{K-moyennes topologiques}
\label{sec:kmeans:topo}

\begin{figure}[!t]

        \begin{center}
	\subfigure[]{\includegraphics[height=35mm]{eps/chapitre4/KMeans_Init.eps}\label{FIG:KMEANS:INIT}}
	\subfigure[]{\includegraphics[height=35mm]{eps/chapitre4/KMeans_Allowed1.eps}}
	\subfigure[]{\includegraphics[height=35mm]{eps/chapitre4/KMeans_Allowed2.eps}}\\
	\subfigure[]{\includegraphics[height=35mm]{eps/chapitre4/KMeans_NAllowed1.eps}}
	\subfigure[]{\includegraphics[height=35mm]{eps/chapitre4/KMeans_NAllowed2.eps}}
	\subfigure[]{\includegraphics[height=35mm]{eps/chapitre4/KMeans_NAllowed3.eps}}
        \end{center}

        \caption[Exemples de configurations finales autorisées ou non pour les K-moyennes topologiques]{\emph{Exemples de configurations finales autorisées ou non pour les K-moyennes topologiques. (a) Initialisation du modèle. (b) Configuration autorisée : les composantes du label 3 sont complètement incluses dans le label 2. (c) Configuration autorisée : les composantes du label 3 sont complètement incluses dans les composantes du label 2, elles mêmes incluses dans le label 1. (d) Configuration non autorisée : le label 3 est connexe au label 1. (e) Configuration non autorisée : le label 2 est en contact avec le fond de l'image. (f) Configuration non autorisée : le label 3 n'est pas complètement inclus dans le label 2. }\label{FIG:KMEAN:ALLOWED}}

        

% \end{figure}
% 
% \begin{figure}[!t]

        \begin{center}
	\subfigure[]{\includegraphics[height=40mm]{eps/chapitre4/inhomogeneity2.eps} \label{FIG:KMEANS:BIAS}}
	\subfigure[]{\includegraphics[height=40mm]{eps/chapitre4/topologie.eps}}
        \end{center}

        \caption[Principes des K-moyennes topologiques]{\emph{(a) Calcul des centroïdes locaux par interpolation des moyennes de région les plus proches. (b) Modèle topologique. Du blanc au gris foncé, les labels sont 0, 1, 2 et 3, 0 étant le fond de l'image. Le voxel 1 ne peut pas changer de label car il y a plus de 3 labels différents dans son voisinage. Le voxel 2 peut changer de label. Le voxel 3 ne peut pas changer car le fond fait partie de son voisinage.}\label{FIG:KMEANS:PRINCIPLE}}

        

\end{figure}

% Le but de cette section est de définir une méthodologie permettant de prendre en compte les contraintes anatomiques décrites plus haut.
Un modèle reposant sur trois sphères (2D ou 3D et au sens topologique du terme) concentriques, chacune représentant une structure particulière, est défini. 
Il tient compte du biais en intensité (par la définition de centroïdes locaux comme en section~\ref{subsec:nl:dd}) et introduit des contraintes géométriques pour prendre en compte les problèmes dus au volume partiel et aux variations d'intensité dans la matière blanche.
Ce modèle est appelé les K-moyennes topologiques.

Rappelons tout d'abord que la segmentation par l'algorithme des K-moyennes est équivalente à la minimisation de la fonction d'énergie suivante : 
\begin{equation}
J_{K\mbox{-}moyennes} = \sum_{k=0}^{K} \sum_{\mathbf{y}_{j} \in S_k} \Vert \mathbf{y}_{j} - \mathbf{v}_{k} \Vert_2^{2},
\end{equation}
où $\mathbf{y}_{j}$ est l'intensité au voxel $j$, $\mathbf{v}_{k}$ est le centroïde de la classe $k$, $S_k$ est l'ensemble des voxels inclus dans la classe $k$ et $K$ est le nombre de classes recherchées (voir la section~\ref{subsubsec:kMeans}).
Dans ce cas précis, la prise en compte de contraintes géométriques ne permet pas de suivre le schéma classique de minimisation de la fonction d'énergie alternant évaluation des centroïdes des classes et classification des éléments de l'image en fonction de la distance par rapport aux centroïdes.
L'optimisation se fait selon un échange de voxels à la frontière des étiquettes, imposant un basculement d'un élément d'une classe $k$ vers une autre classe $k'$ s'il respecte les critères suivants : 
\[
\left\{
\begin{array}{l}
\lvert C_{N_j} \rvert = 2 \mbox{, } \\ 
\forall \ c \in C_{N_j}, c \neq \mbox{ fond,} \\ 
\lVert \mathbf{y}_j - \mathbf{v}_{jk'} \rVert_{2} < \lVert \mathbf{y}_j - \mathbf{v}_{jk} \rVert_{2},
\end{array}
\right.
\]
où $N_j$ est un voisinage autour du voxel $j$, $C_{N_j}$ est l'ensemble des étiquettes présents dans le voisinage $N_j$ et $c$ est une étiquette.

Les deux premières conditions vérifient l'éligibilité d'un voxel au changement d'étiquette. 
Ce changement ne peut se faire que si exactement deux labels se trouvent dans le voisinage du voxel courant $j$ et si l'un de ces labels n'est pas le fond de l'image.
La première condition garantit que deux labels normalement non connexes ne partagent pas de frontière commune.
Les contraintes géométriques sont ainsi préservées.
De la même manière, la deuxième condition rend impossible le changement de label des voxels voisins du fond de l'image.
La troisième condition permet la minimisation de la fonction d'énergie.

La formulation des contraintes géométriques ne correspond pas à celle des points simples car elle ne conserve pas la topologie des composantes connexes.
En effet, des expériences, non présentées ici, ont révélé que les points simples imposent une trop grande rigidité lors du processus de segmentation, bloquant l'évolution des différents labels.
Ces contraintes géométriques sont donc conçues de manière à permettre la division d'un label en plusieurs composantes (voir Figure~\ref{FIG:KMEAN:ALLOWED}), afin de respecter la réalité anatomique des structures que l'on cherche à segmenter (par exemple les ventricules dans le cas d'une segmentation 2D qui peuvent apparaître disjoints dans certaines coupes) et gagner ainsi en flexibilité.
De la même façon, la fusion de deux composantes est autorisée, comportement interdit par les points simples.
Néanmoins, les contraintes géométriques présentées ci-dessus sont conservées (par exemple, un label complètement inclus dans un autre le restera même s'il est divisé en plusieurs composantes).
\`A noter que ces contraintes interdisent l'introduction de nouvelles cavités ou de nouveaux tunnels, sauf en cas de division ou de fusion du label inclus dans le label courant. 
% (comportement proche des points multisimples de~\cite{Segonne:2005}).

Tout comme l'algorithme FCM, les K-moyennes ne prennent pas en compte le biais en intensité présent dans les IRM.
Ce biais est supposé être une variation lente de l'intensité dans l'image et des centroïdes locaux $\mathbf{v}_{jk}$ sont donc introduits afin de prendre en compte cette réalité sans pour autant nécessiter d'autres connaissances particulières sur ce biais.
Ils sont calculés de la façon suivante (voir Figure \ref{FIG:KMEANS:BIAS}) : 
\begin{enumerate}
\item le domaine de l'image $\Omega$ est divisé en sous-volumes $r$,
\item pour chaque sous-volume $r$ et pour chaque classe $k$, une moyenne $\mathbf{v}_{rk}$ est calculée,
\item chaque moyenne locale $\mathbf{v}_{jk}$ résulte d'une interpolation linéaire des 4 (2D) ou 8 (3D) moyennes des régions les plus proches (selon que l'image traitée soit reconstruite ou non), chaque moyenne étant pondérée par l'inverse de la distance du centre des sous-volumes $r$ voisins par rapport au voxel courant. 
\end{enumerate}
En résumé, l'algorithme présenté ici suit le schéma d'optimisation suivant : 
\begin{enumerate}
\item initialisation des labels (comme en Figure \ref{FIG:KMEANS:INIT}) et introduction d'une première évaluation des centroïdes (par exemple, par un clustering classique),
\item évolution des labels selon un échange de voxels aux frontières de manière séquentielle en respectant les contraintes citées ci-dessus, jusqu'à ce qu'aucun changement ne soit enregistré,
\item évaluation des centroïdes des classes, telle que décrite ci-dessus,
\item répétition des étapes 2 et 3 jusqu'à convergence finale (c'est-à-dire, aucun changement d'étiquette enregistré après l'évaluation des centroïdes).
\end{enumerate}

Nous allons maintenant voir comment cet algorithme est utilisé pour obtenir une segmentation du cortex.
% Les échanges de voxels aux frontières des tissus doivent respecter les conditions suivantes : 

% Cette formulation garantie l'invariance de la topologie en imposant le respect de l'intégrité des cercles concentriques et préserve les frontières du fond de l'image.

\subsection{Processus de segmentation}

\begin{figure}[!t]

        \begin{center}
% 	\subfigure[]{\includegraphics[height=45mm]{eps/chapitre4/inhomogeneity2.eps}}
	\includegraphics[height=45mm]{eps/chapitre4/process.eps}
        \end{center}

        \caption[Schéma général du processus de segmentation]{\emph{Schéma du processus de segmentation. \`A partir de l'image originale, les K-moyennes topologiques permettent de réaliser une segmentation séparant le LCR externe, le cerveau et les ventricules. \`A partir de la frontière entre le LCR externe et le cerveau, une zone d'intérêt incluant le cortex est définie. Le cortex est alors segmenté par les K-moyennes topologiques à partir de l'intensité des voxels ainsi que d'une image issue du filtrage Top-Hat de l'image originale.}}

        \label{FIG:FOE:PROCESS}

\end{figure}

La méthode de segmentation du cortex se divise en deux phases distinctes, les deux utilisant les K-moyennes topologiques définies en section précédente (voir Figure~\ref{FIG:FOE:PROCESS}).
La première étape consiste à extraire le cerveau tout en divisant le LCR en LCR externe et LCR interne (le premier représentant le LCR présent autour du cerveau et le deuxième le LCR présent dans le système ventriculaire).
Cela permet de définir la frontière entre le LCR externe et le cerveau, frontière servant de base pour la construction d'une zone d'intérêt incluant le cortex.
La deuxième étape est la segmentation proprement dite du cortex au sein de cette zone d'intérêt.

\subsubsection{Extraction du liquide céphalo-rachidien}

\begin{figure}[!t]

        \begin{center}
	\subfigure[]{\includegraphics[height=30mm]{eps/chapitre4/process_LCR.eps}}\\
	\subfigure[]{\includegraphics[height=33mm]{eps/chapitre4/LCR_Init_Original.eps}}
	\subfigure[]{\includegraphics[height=33mm]{eps/chapitre4/LCR_Init_Distance.eps}\label{FIG:LCR:DISTANCE}}
	\subfigure[]{\includegraphics[height=33mm]{eps/chapitre4/LCR_Init_Init.eps}\label{FIG:LCR:INIT}}
	\subfigure[]{\includegraphics[height=33mm]{eps/chapitre4/LCR_Init_Final.eps}\label{FIG:LCR:FINAL}}
        \end{center}
        \vspace{-3mm}
        \caption[Segmentation en LCR, cerveau, ventricules]{\emph{Séparation des ventricules et du LCR externe. (a) Schéma du processus. (b) Image originale. (c) Carte de distance du volume intracrânien. Les éléments en rouge sont les plus éloignés de la frontière du volume intracrânien. (d) Initialisation en fonction de la carte de distance. Le label LCR externe est initialisé comme une bande d'un voxel d'épaisseur à la frontière du volume intracrânien. Le label \og ventricules \fg{} est la région la plus au centre de ce volume et la limite est fixée à 80\% de la distance intracrânienne maximum. (e) Segmentation finale par les K-moyennes topologiques. Le label LCR s'est étendu jusqu'à la frontière avec le cortex. Légende (pour (d) et (e)) : LCR (bleu), cerveau (jaune), ventricules (rouge).}}

        \label{FIG:LCR:STEPS}

\end{figure}

Lors de cette étape, l'objectif est d'obtenir une séparation du LCR externe des ventricules, de manière à exploiter la frontière entre le LCR externe et le cerveau pour la segmentation du cortex.
Trois sphères concentriques (au sens topologique, 2D ou 3D selon l'image traitée) représentant respectivement le LCR externe, le cerveau et les ventricules sont alors définies.

L'initialisation de ces trois sphères est réalisée par le biais d'une carte de distance intracrânienne, définie à partir d'une segmentation du volume intracrânien et mesurant le distance d'un voxel par rapport à la frontière extérieure de ce volume (voir Figure~\ref{FIG:LCR:DISTANCE}).
L'intérêt de l'utilisation d'une carte de distance est qu'elle permet de positionner la région correspondant aux ventricules à une distance suffisante du LCR externe, de manière à ne pas créer de confusion entre ces deux régions lors du processus de segmentation.

Le LCR externe est initialisé comme une bande d'un voxel d'épaisseur à la frontière entre le volume intracrânien et le fond de l'image (voir Figure~\ref{FIG:LCR:INIT}).
Cette initialisation permet à cette région de s'étendre depuis l'extérieur du volume intracrânien sur l'ensemble des voxels correspondant au LCR externe.
La sphère interne, correspondant aux ventricules, a une limite fixée à 80\% de la distance intracrânienne maximum de manière à prendre en compte la taille du crâne étudié (voir Figure~\ref{FIG:LCR:INIT}).
Ce modèle évolue alors suivant la méthode de segmentation décrite en section~\ref{sec:kmeans:topo} avec l'image originale en entrée de l'algorithme et aboutit à une séparation des ventricules du LCR externe (voir Figure~\ref{FIG:LCR:FINAL}).

\subsubsection{Extraction du cortex}
\label{pipe:cortex}

\begin{figure}[!t]

        \begin{center}
	\subfigure[]{\includegraphics[height=50mm]{eps/chapitre4/process_Cortex.eps}}\\
	\subfigure[]{\includegraphics[height=33mm]{eps/chapitre4/Cortex_Seg_Original.eps}}
	\subfigure[]{\includegraphics[height=33mm]{eps/chapitre4/Cortex_Seg_TopHat.eps}\label{FIG:CORTEX:TOPHAT}}
	\subfigure[]{\includegraphics[height=33mm]{eps/chapitre4/Cortex_Seg_Init.eps}\label{FIG:CORTEX:INIT}}
	\subfigure[]{\includegraphics[height=33mm]{eps/chapitre4/Cortex_Seg_Final.eps}}
        \end{center}
        \vspace{-3mm}
        \caption[Segmentation du cortex - Méthodologie]{\emph{Segmentation du cortex. (a) Schéma du processus. (b) Image originale. (c) En rouge, résultat du filtre Top-Hat dans la zone d'intérêt définie à partir de la frontière entre le LCR externe et le cerveau. (d) Zone d'intérêt et initialisation des labels LCR, cortex et matière blanche. (e) Segmentation finale obtenue par les K-moyennes topologiques. Légende (pour (d) et (e)) : LCR (bleu), cortex (jaune), matière blanche (rouge).}}

\end{figure}


\`A partir de la segmentation du LCR externe, une zone d'intérêt incluant le cortex est construite de part et d'autre de la frontière entre le LCR externe et le cerveau.
Sachant que le cortex est une bande ayant une épaisseur comprise entre 1 et 4 millimètres~\cite{Fischl:PNAS:2000},  la zone d'intérêt est une bande d'une épaisseur totale de 9 millimètres (2 millimètres du côté du LCR externe et 7 millimètres du côté du cerveau). 
La partie de la bande du côté du LCR est initialisée comme LCR, tandis que les 5 premiers millimètres du côté du cerveau sont initialisés comme du cortex et les deux millimètres restants comme de la matière blanche (voir Figure \ref{FIG:CORTEX:TOPHAT}).
Cette initialisation est choisie car elle permet d'une part la construction d'une zone d'intérêt incluant le cortex, d'autre part de disposer d'une quantité de voxels de LCR et de matière blanche significative, de manière à pouvoir appliquer les K-moyennes topologiques en trois classes.

Afin d'assurer la cohérence de la segmentation finale, les voxels classés comme ventricules sont éliminés de cette zone d'intérêt, de même que les voxels appartenant au tronc cérébral et au cervelet.
Ces derniers sont supposés avoir été préalablement segmentés.
Cette segmentation est obtenue par une vérité-terrain.

Cependant, comme précisé précédemment, l'information fournie par l'intensité des voxels est insuffisante pour permettre l'extraction du cortex, même au sein de cette zone réduite.
Pour mettre en valeur le cortex, un opérateur de morphologie mathématique, le \emph{Top-Hat}~\cite{Najman:2010}, est donc utilisé.
Cet opérateur est défini de la manière suivante.
Soit $\varphi_{B}$ la fermeture morphologique de l'image $I$ par un élément structurant $B$.
Le filtre \emph{Top-Hat} est défini par la fonction : $T_d(I) = \varphi_B(I) - I$.
En d'autres termes, ce filtre révèle les zones sombres de l'image, ce qui correspond visuellement au cortex dans l'acquisition des IRM pondérées en T2 (voir Figure \ref{FIG:CORTEX:TOPHAT}).
%  qui forme une bande sombre située entre le LCR externe et la matière blanche.

La segmentation est effectuée en exécutant l'algorithme des K-moyennes topologiques avec deux entrées, qui sont l'image originale et l'image filtrée par le \emph{Top-Hat}.
Ainsi, une classe est caractérisée par un vecteur de centroïdes $\mathbf{v}_{k}$, composée de la valeur moyenne issue de l'intensité des voxels $v_{k}^{I}$ et la valeur moyenne issue du filtre \emph{Top-Hat} $v_{k}^{TH}$ (on a donc $\mathbf{v}_{k} = (v_{k}^{I},v_{k}^{TH} )$),  permettant ainsi une meilleure discrimination du cortex.

\section{Validations}
\label{sec:foetus:validation}

% Les validations de cette méthodes de segmentation sont menées sur une base de 8 cas et son comportement est étudié aussi bien dans le cas d'image reconstruites que non-reconstruites.
La validation est menée dans un premier temps sur des images \og brutes \fg{} (c'est-à-dire non reconstruites), puis sur des volumes reconstruits à partir de trois acquisitions de faible résolution effectuées dans les directions axiale, sagittale et coronale.
Deux méthodes de reconstruction sont utilisées au cours de cette validation.
La première est celle présentée dans~\cite{Rousseau:AR:2006}, qui reconstruit la valeur d'un voxel de l'image haute-résolution comme une interpolation des valeurs des voxels des images basse-résolution.
La deuxième est celle présentée dans~\cite{Rousseau:MIA:2010}, incluant une approche de super-résolution tenant compte d'un modèle physique de l'acquisition de l'image.
% L'extension de la méthodologie des données 2D à 3D est immédiate.

\subsection{Images non reconstruites}

\subsubsection{Caractéristiques et paramètres}
\label{subsubsec:foetus:param}

Les expériences sont menées sur huit cas acquis avec un imageur IRM de 1.5 Tesla (Magnetom Avento, Siemens, Erlangen, Allemagne) utilisant des séquences d'écho de spins ultra-rapides.
Chaque cas présente un ensemble de trois acquisitions correspondant respectivement aux images axiale, coronale et sagittale.
L'âge des différents f\oe tus s'étend de 27 à 34 semaines d'aménorrhée (SA). 
Le tableau~\ref{TAB:UNBUILD:CHARAC} résume les caractéristiques des images.

\begin{table}[!t]

\begin{center}

\begin{tabular}{|c|c|c|c|}
\hline
Cas & Direction de l'acquisition & Taille de l'image & Taille des voxels en mm\\
\hline
\hline
\multirow{3}*{Cas n\textdegree1} 
        & Axiale & $512\times512\times19$ & $0.742\times0.742\times4.60$\\ \cline{2-4}
        & Coronale & $512\times512\times19$ & $0.742\times0.742\times4.60$\\ \cline{2-4}
        & Sagittale & $512\times512\times19$ & $0.742\times0.742\times4.60$\\
\hline
\hline
\multirow{3}*{Cas n\textdegree2} 
        & Axiale & $512\times512\times19$ & $0.742\times0.742\times4.60$\\ \cline{2-4}
        & Coronale & $512\times512\times19$ & $0.742\times0.742\times4.60$\\ \cline{2-4}
        & Sagittale & $512\times512\times19$ & $0.742\times0.742\times4.60$\\
\hline
\hline
\multirow{3}*{Cas n\textdegree3} 
        & Axiale & $512\times512\times20$ & $0.742\times0.742\times3.45$\\ \cline{2-4}
        & Coronale & $512\times512\times20$ & $0.742\times0.742\times3.45$\\ \cline{2-4}
        & Sagittale & $512\times512\times17$ & $0.742\times0.742\times3.45$\\
\hline
\hline
\multirow{3}*{Cas n\textdegree4} 
        & Axiale & $512\times512\times19$ & $0.742\times0.742\times3.45$\\ \cline{2-4}
        & Coronale & $512\times512\times19$ & $0.742\times0.742\times3.45$\\ \cline{2-4}
        & Sagittale & $512\times512\times19$ & $0.742\times0.742\times3.45$\\
\hline
\hline
\multirow{3}*{Cas n\textdegree5} 
        & Axiale & $512\times512\times19$ & $0.742\times0.742\times4.60$\\ \cline{2-4}
        & Coronale & $512\times512\times19$ & $0.742\times0.742\times4.60$\\ \cline{2-4}
        & Sagittale & $512\times512\times19$ & $0.742\times0.742\times4.60$\\
\hline
\hline
\multirow{3}*{Cas n\textdegree6} 
        & Axiale & $512\times512\times19$ & $0.742\times0.742\times4.60$\\ \cline{2-4}
        & Coronale & $512\times512\times19$ & $0.742\times0.742\times4.60$\\ \cline{2-4}
        & Sagittale & $512\times512\times19$ & $0.742\times0.742\times4.60$\\
\hline
\hline
\multirow{3}*{Cas n\textdegree7} 
        & Axiale & $512\times512\times19$ & $0.742\times0.742\times4.60$\\ \cline{2-4}
        & Coronale & $512\times512\times19$ & $0.742\times0.742\times4.60$\\ \cline{2-4}
        & Sagittale & $512\times512\times19$ & $0.742\times0.742\times4.60$\\
\hline
\hline
\multirow{3}*{Cas n\textdegree8} 
        & Axiale & $512\times512\times20$ & $0.742\times0.742\times3.45$\\ \cline{2-4}
        & Coronale & $512\times512\times17$ & $0.742\times0.742\times3.45$\\ \cline{2-4}
        & Sagittale & $512\times512\times17$ & $0.742\times0.742\times3.45$\\
\hline
 
\end{tabular}
\caption[Caractéristiques des images utilisées lors de la validation (images non-reconstruites)]{\emph{Caractéristiques des images utilisées lors de la validation. L'importance de l'anisotropie conduit à une segmentation orientée 2D.}\label{TAB:UNBUILD:CHARAC}}
\end{center}

\end{table}

Ces images étant anisotropes, les K-moyennes topologiques évoluent en deux dimensions et utilise un 4-voisinage pour l'évolution des différents labels. 
% (ou 8-voisinage par complément).
Les régions utilisées pour le calcul des moyennes de régions sont d'une taille $32\times32\times1$.
Ceci permet de disposer d'une distribution en intensité des différents tissus cohérente dans chaque sous-volume tout en prenant en compte de l'inhomogénéité de l'image.
L'élément structurant utilisé pour l'opérateur \emph{Top-Hat} est un cube de taille $5\times5\times1$, ce qui donne un cube de $3.71\times3.71\times3.45$ mm$^3$ (ou $3.71\times3.71\times4.6$ mm$^3$).
Le cortex se présentant sous la forme d'une mince bande sombre, cette taille est suffisante pour le mettre en valeur par un filtre \emph{Top-Hat}.

Afin d'améliorer les performances de l'algorithme général, un prétraitement par un filtrage non-local \cite{Coupe:TMI:2008} est effectué avec une zone de recherche de taille $11\times11\times3$ et des patchs de taille $3\times3\times1$ de manière à éliminer une partie du bruit présent dans les images.

\subsubsection{Résultats}

Chaque acquisition dispose d'au moins une segmentation manuelle, réalisée par des experts médicaux, servant de vérité-terrain.
Dans les cas où plus d'une vérité-terrain est disponible, une comparaison quantitative est effectuée entre ces vérités-terrains de manière à évaluer la variabilité inter-experts.
Toutes les évaluations sont réalisées grâce au coefficient Dice défini en section~\ref{sec:nlfcm:validations}.

\paragraph{\'Evaluation quantitative}

\begin{table}[!t]
\begin{center}

\begin{tabular}{|c|c|c|c|}
\hline
Cas (SA) & Direction de l'acquisition & Dice 3D & Dice maximum \\
\hline
\hline
\multirow{3}*{1(33)} 
        & Axiale & 58.20 & 65.13\\ \cline{2-4}
        & Coronale & 58.55 & 68.64\\ \cline{2-4}
        & Sagittale & 51.91 & 68.07\\
\hline
\hline
\multirow{3}*{2(28)} 
        & Axiale & 65.20 & 77.77\\ \cline{2-4}
        & Coronale & 66.97 & 76.36\\ \cline{2-4}
        & Sagittale & 61.90 & 74.14 \\
\hline
\hline
\multirow{3}*{3(30)} 
        & Axiale & 56.14 & 75.20\\ \cline{2-4}
        & Coronale & 63.81 & 76.87\\ \cline{2-4}
        & Sagittale & 52.07 & 69.06\\
\hline
\hline
\multirow{3}*{4(26)} 
        & Axiale & 72.53 & 81.74\\ \cline{2-4}
        & Coronale & 72.01 & 82.15\\ \cline{2-4}
        & Sagittale & 61.32 & 73.90\\
\hline
\hline
\multirow{3}*{5(34)} 
        & Axiale & 53.51 & 61.54\\ \cline{2-4}
        & Coronale & 48.38 & 61.05\\ \cline{2-4}
        & Sagittale & 43.94 & 55.32\\
\hline
\hline
\multirow{3}*{6(32)} 
        & Axiale & 58.80 & 72.16\\ \cline{2-4}
        & Coronale & 61.04 & 74.90\\ \cline{2-4}
        & Sagittale & 49.33 & 66.47\\
\hline
\hline
\multirow{3}*{7(-)} 
        & Axiale & 46.89 & 57.68\\ \cline{2-4}
        & Coronale & 53.20 & 62.69\\ \cline{2-4}
        & Sagittale & 45.97 & 59.77\\
\hline
\hline
\multirow{3}*{8(27)} 
        & Axiale & 70.81 & 78.65\\ \cline{2-4}
        & Coronale & 66.17 & 74.31\\ \cline{2-4}
        & Sagittale & 53.37 & 78.24\\
\hline
\hline
 \multirow{3}*{Moyenne $\pm$ écart-type} 
        & Axiale & 60.26 $\pm$ 8.17 & -\\ \cline{2-4}
        & Coronale & 61.27 $\pm$ 7.22 & -\\ \cline{2-4}
        & Sagittale & 48.79 $\pm$ 11.2 & -\\
\hline
\end{tabular}

\end{center}
\caption[Coefficients Dice issus de segmentations du cortex (images non reconstruites)]{\emph{Coefficients Dice illustrant le recouvrement entre la vérité-terrain et les segmentations automatiques. Dice 3D : coefficient global. Dice maximum : score maximum obtenu en effectuant une analyse coupe à coupe.}\label{TAB:DICE:UNBUILD}}
\end{table}

Le tableau~\ref{TAB:DICE:UNBUILD} fournit les résultats quantitatifs des différentes segmentations.
Les coefficients Dice moyens pour chacune des trois orientations sont : 60.26 pour l'axiale, 61.27 pour la coronale et 48.79 pour la sagittale.
Nous pouvons constater que les résultats sont globalement similaires pour une segmentation d'images acquises selon les directions axiale et coronale, mais ils illustrent une mauvaise adéquation de la méthode avec la direction sagittale.
% Ce constat est cependant peu surprenant, étant donné l'apparence des structures cérébrales vues dans une direction sagittale.
% La zone du corps caleux est particulièrement inadaptée au modèle développé, tandis que les directions axiales et coronales sont adaptées au modèles.
Les valeurs des écarts-types montrent une forte variabilité des résultats de la segmentation, qui peut s'expliquer largement par la qualité de l'image traitée (présence d'un bruit plus ou moins important, cortex plus ou moins net, présence d'un hypersignal au sein de la matière blanche, \ldots) (voir Figure~\ref{FIG:CORTEX:UNBUILD:PEDPR}).

\begin{figure*}[!t]
\centering
\subfigure[]{\includegraphics[height=40mm]{eps/chapitre4/PED_Pr_Axial_Grey.eps}}
\hspace{0.1mm}
\subfigure[]{\includegraphics[height=40mm]{eps/chapitre4/PED_Pr_Axial_Seg_01.eps}}
\hspace{0.1mm}
\subfigure[]{\includegraphics[height=40mm]{eps/chapitre4/PED_Pr_Axial_Seg_02.eps}}
\caption[Illustration de l'effet d'un hypersignal dans la matière blanche sur la segmentation]{
\emph{Illustration de l'effet d'un hypersignal dans la matière blanche sur la segmentation. (a) Image IRM à niveaux de gris. (b) Séparation du LCR interne et du LCR externe. Légende : LCR externe (rouge), cerveau (vert), LCR interne (bleu). (c) Segmentation du cortex. Légende : LCR (rouge), cortex (vert), matière blanche et noyaux gris (bleu).}
\label{FIG:CORTEX:UNBUILD:PEDPR}}
% \vspace{-6mm}
\end{figure*}

Une plus grande dispersion est observée dans la direction sagittale, confirmant la plus faible adéquation du modèle à cette direction, tandis que les résultats obtenus dans les directions axiale et coronale présentent une dispersion similaire.
Cependant, la faible valeur absolue du coefficient Dice incite à une observation plus précise des résultats.

\paragraph{Evaluation qualitative}

\begin{figure*}[!t]
\centering
\subfigure[]{\includegraphics[height=40mm]{eps/chapitre4/TAB_Ar_Cortex_Truth.eps}} \label{cortex:truth}
\hspace{0.1mm}
\subfigure[]{\includegraphics[height=40mm]{eps/chapitre4/ESC_Mi_Cortex_Truth.eps}} \label{cortex2:truth}
\hspace{0.1mm}
\subfigure[]{\includegraphics[height=40mm]{eps/chapitre4/ARS_Hu_Cortex_Truth.eps}} \label{cortex3:truth}\\

% \vspace{-3mm}

\subfigure[]{\includegraphics[height=40mm]{eps/chapitre4/TAB_Ar_Cortex_Seg.eps} \label{cortex:final}}
\subfigure[]{\includegraphics[height=40mm]{eps/chapitre4/ESC_Mi_Cortex_Seg.eps} \label{cortex2:final}}
\subfigure[]{\includegraphics[height=40mm]{eps/chapitre4/ARS_Hu_Cortex_Seg.eps} \label{cortex3:final}}\\

% \vspace{-5mm}

\caption[Extraction du cortex (images non reconstruites)]{
\emph{Extraction du cortex. (a,b,c): vérités-terrains, (d,e,f) : régions d'intérêt avec la segmentation finale. Légende : LCR (rouge), cortex (vert), matière blanche et noyaux gris (bleu).}
\label{FIG:CORTEX:UNBUILD:VIEW}}
\vspace{-6mm}
\end{figure*}

La Figure~\ref{FIG:CORTEX:UNBUILD:VIEW} présente les résultats de certaines segmentations en coupe axiale.
Elle confirme la pertinence du modèle proposé malgré une sous-segmentation dans certaines zones.
De manière générale, de moins bons résultats sont observés au niveau de la segmentation des coupes sagittales, comme attendu au vu des résultats quantitatifs.
La sous-segmentation est observée dans des zones où le contraste entre le cortex et les tissus environnants est la moins prononcée, conduisant à une moins bonne efficacité du filtre \emph{Top Hat} pour révéler le cortex.

Dans le cas des images orientées dans la direction axiale, l'observation des résultats coupe à coupe montre une bonne adéquation du modèle à l'anatomie cérébrale dans la partie supérieure du cerveau, c'est-à-dire au-dessus des troisième et quatrième ventricules.
En effet, ces ventricules sont reliés au LCR externe, introduisant une ambiguïté quant à la localisation de la limite entre ventricules et LCR externe.
Les coupes supérieures permettent de distinguer nettement les ventricules du LCR externe, ce qui est compatible avec le modèle présenté.

Dans le cas des images orientées dans la direction coronale, l'observation des résultats coupe à coupe confirme la bonne adaptation du modèle à cette orientation.
En effet, dans la plupart des coupes, les ventricules sont séparés du LCR externe.
Cependant, une ambiguïté est présente à l'endroit où le quatrième ventricule rejoint le LCR externe, conduisant à sur-évaluer l'étendue de ce dernier et donc à définir une zone d'intérêt trop large, provoquant l'apparition de faux positifs dans la segmentation, surtout dans la région autour du cervelet et du tronc cérébral (voir Figure~\ref{FIG:CORTEX:UNBUILD:CORO}).
% Cela s'explique par la non-adaptation du modèle à cette vue particulière, notamment concernant la zone entre les deux hémisphères cérébraux.

\begin{figure*}[!t]
\centering
\subfigure[]{\includegraphics[height=37mm]{eps/chapitre4/TAB_Ar_01_Coronal_Grey_01.eps}}
\hspace{0.1mm}
\subfigure[]{\includegraphics[height=37mm]{eps/chapitre4/TAB_Ar_01_Coronal_Grey_02.eps}}
\hspace{0.1mm}
\subfigure[]{\includegraphics[height=37mm]{eps/chapitre4/TAB_Ar_01_Coronal_Grey_03.eps}}
\hspace{0.1mm}
\subfigure[]{\includegraphics[height=37mm]{eps/chapitre4/TAB_Ar_01_Coronal_Grey_04.eps}}\\

% \vspace{-3mm}

\subfigure[]{\includegraphics[height=37mm]{eps/chapitre4/TAB_Ar_01_Coronal_Seg_01.eps}}
\subfigure[]{\includegraphics[height=37mm]{eps/chapitre4/TAB_Ar_01_Coronal_Seg_02.eps}}
\subfigure[]{\includegraphics[height=37mm]{eps/chapitre4/TAB_Ar_01_Coronal_Seg_03.eps}}
\subfigure[]{\includegraphics[height=37mm]{eps/chapitre4/TAB_Ar_01_Coronal_Seg_04.eps}}\\

% \vspace{-5mm}

\caption[Segmentation de quatre coupes coronales consécutives d'une image IRM non-reconstruite]{
\emph{Segmentation de quatre coupes coronales consécutives d'une image IRM non-reconstruite. Il est possible d'observer sur ces coupes la connexion entre le LCR externe et le LCR interne et l'effet que produit cette connexion lors du processus de segmentation. Par exemple, le résultat de la segmentation (images (f) et (g)) montre que le ventricule gauche a été classé comme LCR externe, entraînant la présence d'une mince couche de cortex autour de lui. Première ligne : images à niveaux de gris. Deuxième ligne : segmentation. Légende : LCR (rouge), cortex (vert), matière blanche et noyaux gris (bleu).}
\label{FIG:CORTEX:UNBUILD:CORO}}
\vspace{-6mm}
\end{figure*}

\paragraph{Evaluation croisée entre experts et segmentation automatique}

Dans les cas où plusieurs segmentations manuelles sont disponibles pour un même patient, nous avons effectué une comparaison de ces segmentations afin d'évaluer la variabilité inter-experts pour la segmentation d'une même structure.
Le tableau~\ref{TAB:DICE:UNBUILD:EXP} rapporte les résultats de cette comparaison ainsi que les coefficients Dice entre la segmentation automatique et les différentes segmentations manuelles.
Nous pouvons observer que les coefficients Dice mesurant le taux de recouvrement entre deux segmentations manuelles ont une valeur d'environ 60\%, illustrant la variabilité existant entre deux experts pour l'évaluation du cortex.

Plusieurs causes peuvent expliquer cet écart.
Nous pouvons évoquer la finesse d'une structure comme le cortex, qui dans la plupart des cas, a une épaisseur de quelques voxels seulement, la rendant très sensible aux variabilités de la segmentation.
Enfin, il est difficile de décider d'une limite claire du cortex dans le cas de volumes non-reconstruits. 
En effet, le volume partiel tend à réduire le contraste dans certaines zones, notamment les sillons, ce qui a pour effet de créer des discontinuités.
L'expert a alors toute latitude de faire figurer le cortex ou de considérer que la structure n'étant pas visible, elle ne doit pas figurer sur la segmentation manuelle.

L'étude des coefficients Dice entre la segmentation automatique et les segmentations manuelles montre une similarité avec les résultats de la comparaison des segmentations manuelles.
Dans certains cas, le coefficient Dice entre la segmentation automatique et un des deux experts est supérieur à celui mesurant la similarité entre les experts.
Cette variabilité des résultats illustre la difficulté d'obtenir une segmentation fiable du cortex, à partir d'IRM présentant une forte anisotropie (et donc un important effet de volume partiel) et une faible dissociabilité des tissus.

\begin{table}[!t]
\begin{center}

\begin{tabular}{|c|c|c|c|c|}
\hline
Cas (SA) & Direction de l'acquisition & Exp 1 - Exp 2 & Seg - Exp 1 & Seg - Exp 2\\
\hline
\hline
\multirow{3}*{3(30)} 
        & Axiale & 61.10 & \textbf{63.64} & 56.14\\ \cline{2-5}
        & Coronale & - & - & -\\ \cline{2-5}
        & Sagittale & \textbf{61.71} & 54.84 & 52.07\\
\hline
\hline
\multirow{3}*{4(26)} 
        & Axiale & 68.21 & \textbf{72.53} & 59.81\\ \cline{2-5}
        & Coronale & \textbf{74.41} & 72.01 & 70.31\\ \cline{2-5}
        & Sagittale & \textbf{68.73} & 61.32 & 60.25\\
\hline
\hline
\multirow{3}*{5(34)} 
        & Axiale & \textbf{60.99} & 48.09 & 53.51\\ \cline{2-5}
        & Coronale & \textbf{56.82} & 48.38 & 49.35\\ \cline{2-5}
        & Sagittale & \textbf{47.46} & 40.75 & 43.94\\
\hline
\hline
\multirow{3}*{6(32)} 
        & Axiale & 60.97 & \textbf{65.84} & 58.80\\ \cline{2-5}
        & Coronale & - & - & -\\ \cline{2-5}
        & Sagittale & \textbf{59.06} & 49.33 & 43.10\\
\hline
\end{tabular}
\caption[Comparaisons croisées entre les segmentations manuelles et automatique (images non reconstruites)]{\emph{Comparaison croisées par le calcul des coefficients Dice entre les segmentations manuelles et automatiques : Expert 1 contre expert 2, segmentation automatique contre expert 1, segmentation automatique contre expert 2. Pour chaque cas et chaque direction d'acquisition, le résultat en gras est le coefficient le plus élevé.}\label{TAB:DICE:UNBUILD:EXP}}
\end{center}
\end{table}

En conclusion, l'ensemble des résultats illustre néanmoins la possibilité d'obtenir une segmentation du cortex comparable à celle d'experts médicaux.
Cette segmentation est obtenue à partir d'une méthode mêlant des connaissances anatomiques et des données structurelles afin d'obtenir une segmentation du cortex.
Cependant, l'effet de volume partiel ainsi que la faible dissociabilité des tissus rend la tâche particulièrement difficile, même pour des experts.


\subsection{Images haute résolution}

L'intérêt d'utiliser des images reconstruites est d'obtenir des segmentations de meilleure qualité et plus précises de manière à permettre une étude plus avancée des propriétés des tissus cérébraux chez le f\oe tus.
Ces images sont isotropes, permettant de réaliser une réelle segmentation en 3D et non coupe à coupe comme dans la section précédente, ouvrant la voie à des mesures anatomiques, telles que le volume des différents tissus ou l'épaisseur corticale.
Elles sont reconstruites en suivant la méthode issue de~\cite{Rousseau:AR:2006} à partir de trois acquisitions respectivement axiale, coronale et sagittale.

\subsubsection{Caractéristiques et paramètres}

Pour cette étude, nous disposons de six cas.
% La méthode de reconstruction utilisée est celle de \cite{Rousseau:AR:2006}.
% Pour chaque cas, un volume 3D est reconstruit à partir d'acquisition dans trois directions différentes : axiale, coronale et sagittale.
Les images reconstruites ont pour dimensions $256\times256\times88$ à $256\times256\times117$ voxels.
La résolution des voxels est de $0.742\times0.742\times0.742$ mm$^3$.

Un 6-voisinage 3D est utilisé pour mettre en \oe uvre l'algorithme des K-moyennes topologiques.
Un élément structurant de taille $5\times5\times5$ est utilisé pour l'opérateur \emph{Top-Hat}, ce qui correspond à un cube de dimensions $3.71\times3.71\times3.71$ mm$^3$ (choix réalisé après expérimentations).
L'initialisation des différents labels, aussi bien à l'étape d'extraction du LCR qu'à l'étape de segmentation du cortex, est la même que pour les images non-reconstruites.

La segmentation du tronc cérébral et du cervelet est obtenue par la reconstruction des vérités-terrains issues des images non-reconstruites.
La vérité-terrain du cortex est issue d'une segmentation manuelle, la reconstruction de cette structure à partir des vérités-terrains des images basses-résolutions ne s'étant pas révélée suffisamment fiable.

\subsubsection{Résultats}

L'évaluation de l'algorithme de segmentation est effectuée par une comparaison entre une segmentation manuelle du cortex servant de vérité-terrain et le résultat de la segmentation automatique.
L'influence de l'initialisation du cortex est testée afin de montrer la convergence de l'algorithme, les résultats correspondant à cette étude étant montrés en Figure~\ref{FIG:CORTEX:BUILD:INIT}.
Cette figure présente deux courbes correspondant respectivement à l'évolution du coefficient de similarité Dice moyen (moyenne calculée sur l'ensemble des cas) lors de l'initialisation de l'algorithme en fonction de l'épaisseur initiale du cortex, et l'évolution du coefficient moyen mesurant la similarité de la segmentation finale en fonction de cette épaisseur.
Une épaisseur initiale de $3$ ou $4$ mm présente un coefficient Dice relativement élevé (autour de 68\%), ce qui n'entraîne pas un gain très significatif lors du processus de segmentation (Dice autour de $75$\%).
Cependant, une initialisation à $2$ ou $5$ mm présente une plus faible similarité avec la vérité-terrain, mais la valeur finale reste très proche de celle obtenue avec une initialisation à $4$ mm.
Ainsi, le coefficient Dice passe d'environ $48$\% à l'initialisation à environ $72$\% à la fin de l'algorithme dans le cas d'une initialisation à $2$ mm d'épaisseur.
Ces résultats illustrent une faible sensibilité à l'initialisation de l'algorithme de segmentation.

Le tableau~\ref{TAB:CORTEX:BUILD} présente les résultats de la segmentation sur chacun des cas traités, ainsi que la moyenne des coefficients Dice et l'écart-type.
Une amélioration significative par rapport à la segmentation des images non-reconstruites est constatée.
En effet, la moyenne des coefficients de similarité est significativement plus grande que dans le cas d'images non reconstruites (au mieux $61$\% contre environ $75$\%) avec une dispersion bien plus réduite (au mieux $7$\% contre environ $2$\%).
Ceci peut s'expliquer par les effets de l'algorithme de reconstruction qui tend à corriger les imperfections de l'image (correction du bruit, du biais et de certains artéfacts de mouvement).
De plus, le traitement d'un volume 3D tend à réduire le problème présenté par l'épaisseur des coupes des images non-reconstruites, notamment un effet de volume partiel plus important. 
Des détails supplémentaires sur le cortex sont disponibles et permettent de mieux conduire la segmentation.

La Figure~\ref{FIG:CORTEX:BUILD:VIEW} présente une illustration des résultats de la segmentation. 
Un phénomène de sous-segmentation est toujours visible sur certaines parties de l'image, mais l'apport des contraintes géométriques est bien mis en évidence par l'absence d'erreurs dues aux effets de volume partiel (présence de matière blanche entre le LCR et le cortex).
Aucune discontinuité du cortex n'est observée, ce qui favorise le processus de segmentation de cette structure.
Cette continuité permet d'observer une meilleure prise en compte des sillons et d'envisager leur suivi durant les dernières semaines de grossesse.
Cependant, de même que pour les images non-reconstruites, les contraintes géométriques imposées par le modèle conduisent à la présence de faux positifs pour la segmentation du cortex.
Ce phénomène est particulièrement visible dans la région du cerveau où le tronc cérébral rejoint le corps calleux.
Les principaux problèmes sont toujours la séparation des ventricules et du LCR externe qui peut être mal positionnée et l'absence de critères permettant de diminuer la probabilité d'apparition de voxels classés comme cortex dans cette zone.

\begin{figure}[!tb]
\centering
\includegraphics[height=38mm]{eps/chapitre4/performance.eps}
% \vspace{-4mm}
\caption[Comparaison des coefficients Dice moyens en fonction de l'épaisseur de l'initialisation du cortex]{\emph{Comparaison des coefficients Dice moyens (sur l'ensemble des cas présentés dans cette étude) en fonction de l'épaisseur de l'initialisation du cortex. Rouge : coefficient Dice de l'initialisation. Bleu : coefficient Dice de la segmentation finale.}\label{FIG:CORTEX:BUILD:INIT}}
% \vspace{-3mm}
\end{figure}

\begin{figure}[!tb]
\centering
\subfigure[]{\includegraphics[height=39mm]{eps/chapitre4/axial_3D_truth.eps}} \label{axial:truth}
\subfigure[]{\includegraphics[height=39mm]{eps/chapitre4/HER_Au_3D_truth.eps} \label{axial2:truth}}
\subfigure[]{\includegraphics[height=39mm]{eps/chapitre4/DER_An_3D_truth.eps} \label{case3:truth}}\\
% \hspace{0.1mm}
\subfigure[]{\includegraphics[height=39mm]{eps/chapitre4/axial_3D_seg.eps}} \label{axial:seg}
\subfigure[]{\includegraphics[height=39mm]{eps/chapitre4/HER_Au_3D_seg.eps} \label{axial2:seg}}
\subfigure[]{\includegraphics[height=39mm]{eps/chapitre4/DER_An_3D_seg.eps} \label{axial3:seg}}\\

\caption[Segmentation du cortex (images reconstruites)]{
\emph{Segmentation du cortex. (a,b,c) Segmentation manuelle. (d,e,f) Segmentation automatique. Légende : LCR (rouge), cortex (vert), matière blanche et noyaux gris (bleu).}
\label{FIG:CORTEX:BUILD:VIEW}}
% \vspace{-6mm}
\end{figure}

\begin{table}[t]

\begin{center}
\small{
% \small
\begin{tabular}{|c|c|c|c|c|c|c|c|}
\hline
Cas (SA) & 1 (28) & 2 (30) & 3 (26) & 4 (32) & 5 (27) & 6 (30) & Moyenne $\pm$ écart-type\\
\hline
% $Sen$ & 77.83 & 80.61 & 77.78 & 78.61 & 86.29 & 78.84\\
% \hline
% $Sen$ with regularization & 80.19 & 82.79 & 74.08 & 72.69 & 85.45 & 75.59\\
% \hline
$Dice$ & 72.42 & 73.03 & 77.57 & 74.51 & 76.60 & 76.61 &  75.12 $\pm$ 1.93\\
% \hline
% \hspace{1mm} $DSC$ with regularization  \hspace{1mm} & 71.02 & 71.37 & 77.76 & 71.86 & 75.78 & 75.23\\
\hline
\end{tabular}
}
\end{center}
% \vspace{-2mm}
\caption[Coefficients Dice entre vérités-terrains et segmentations automatiques (images reconstruites)]{\emph{Coefficients Dice entre les vérités-terrains et la segmentation automatique des images reconstruites selon la méthode issue de \cite{Rousseau:AR:2006}. Une nette amélioration, tant au niveau des coefficients que de la dispersion des résultats, par rapport aux images non-reconstruites est observée.}\label{TAB:CORTEX:BUILD}}
% \vspace{-10mm}
\label{tab:coronal:overlap}

\end{table}

Ces résultats préliminaires confirment la possibilité de segmenter le cortex de manière fiable malgré l'absence d'\emph{a priori} spatiaux issus d'un atlas ou d'une étape de régularisation spécifique. 
Cependant, une segmentation préalable du volume intracrânien, du cervelet et du tronc cérébral est nécessaire pour pouvoir exécuter l'ensemble du processus.
La nécessité d'utiliser une contrainte géométrique (revenant à dire que le cortex est forcément connexe au LCR) pour tenir compte de l'effet de volume partiel indique qu'il est nécessaire d'introduire une information anatomique \emph{a priori} afin de guider le processus de segmentation.

% Cependant, comme précisé en section \ref{pipe:cortex}, cette méthodologie s'appuie sur une segmentation préalable du tronc cérébrale et du cervelet, ainsi qu'une extraction du volume intracrânien.
% Une méthode d'extraction automatique du volume intracrânien, basée sur des opérateurs de morphologie mathématique, existe~\cite{Anquez:ISBI:2009} et la séparation des deux hémisphères et du cervelet est une opération déjà réalisée dans des cas adultes, qui pourrait être adaptée aux images reconstruites en IRM f\oe tale.

\subsection{Images reconstruites par super-résolution}

\begin{figure}[!tb]
\centering
\subfigure[]{\reflectbox{\includegraphics[angle=90, height=39mm]{eps/chapitre4/TAB_Ar_02_HR.eps}}} \label{HR}
\subfigure[]{\includegraphics[height=39mm]{eps/chapitre4/TAB_Ar_02_SR.eps} \label{SR}}

\caption[Comparaison entre une image reconstruite selon deux procédés de reconstruction différents]{
\emph{Comparaison entre une image reconstruite selon (a) \cite{Rousseau:AR:2006} et (b) \cite{Rousseau:MIA:2010}. La principale différence est un meilleur contraste entre les tissus dû à un lissage moins important.}
\label{FIG:COMPARE:HR:SR}}
% \vspace{-6mm}
\end{figure}

Cette section présente des résultats préliminaires issus de la segmentation de volumes reconstruits selon une méthode de super-résolution \cite{Rousseau:MIA:2010}.
Les images issues de cette approche se révèlent être plus facilement exploitables car l'effet de lissage de la précédente méthode de reconstruction est moins accentué et les contrastes entre les tissus sont plus importants, comme illustré en Figure~\ref{FIG:COMPARE:HR:SR}.
Nous présentons une analyse qualitative des résultats ainsi qu'une étude succincte de l'apparition des différents sillons  cérébraux au cours de la grossesse.

\subsubsection{Analyse des résultats}

\begin{figure}[!tb]
\centering
\subfigure[]{\reflectbox{\includegraphics[angle=270, totalheight=39mm]{eps/chapitre4/TAB_Ar_02_HR_Original.eps}}} \label{HR:Original}
\subfigure[]{\reflectbox{\includegraphics[angle=270, totalheight=39mm]{eps/chapitre4/TAB_Ar_02_HR_Seg.eps}}} \label{HR:Seg} \\
\subfigure[]{\includegraphics[height=39mm]{eps/chapitre4/TAB_Ar_02_SR_Original.eps}} \label{SR:Original}
\subfigure[]{\includegraphics[height=39mm]{eps/chapitre4/TAB_Ar_02_SR_Seg.eps}} \label{SR:Seg}

\caption[Comparaison entre les segmentations d'images reconstruites selon deux procédés de reconstruction différents]{
\emph{Comparaison entre les segmentations d'images reconstruites selon (a) \cite{Rousseau:AR:2006} et (c) \cite{Rousseau:MIA:2010}. (b) et (d) sont les segmentations respectives de (a) et (c). Le principal effet notable est la correction de la sur-segmentation du cortex. Légende : LCR (rouge), cortex (vert), matière blanche et noyaux gris (bleu).}
\label{FIG:COMPARE:HR:SR:SEG}}
% \vspace{-6mm}
\end{figure}

\begin{figure}[!tb]
\centering
\subfigure[]{\includegraphics[height=39mm]{eps/chapitre4/TAB_Ar_02_HR_WM.eps}} \label{HR:WM}
\subfigure[]{\includegraphics[height=39mm]{eps/chapitre4/TAB_Ar_02_HR_WMandCortex.eps}} \label{HR:WMandCortex} \\
\subfigure[]{\includegraphics[height=39mm]{eps/chapitre4/TAB_Ar_02_SR_WM.eps}} \label{SR:WM}
\subfigure[]{\includegraphics[height=39mm]{eps/chapitre4/TAB_Ar_02_SR_WMandCortex.eps}} \label{SR:WMandCortex}

\caption[Visualisation 3D des segmentations d'images reconstruites selon deux procédés de reconstruction différents]{\emph{Visualisation des segmentations d'images reconstruites selon \cite{Rousseau:AR:2006} (première ligne) et \cite{Rousseau:MIA:2010} (deuxième ligne). (a) et (c) représentent la surface de la matière blanche. (b) et (d) représentent la surface du cortex.}
\label{FIG:COMPARE:HR:SR:3D}}
% \vspace{-6mm}
\end{figure}

L'utilisation de la super-résolution favorise une meilleure segmentation du cortex grâce au meilleur contraste existant entre le cortex et les tissus environnants, notamment la matière blanche.
Ceci favorise l'efficacité du filtre \emph{Top-Hat} pour la mise en valeur du cortex.
La Figure~\ref{FIG:COMPARE:HR:SR:SEG} montre la différence entre la segmentation d'une image simplement reconstruite et une image reconstruite selon la super-résolution.
Le principal effet notable de l'utilisation de la super-résolution est la correction de la sur-segmentation. 
En effet, le cortex bénéficiant d'un meilleur contraste par rapport à la matière blanche, le filtre \emph{Top-Hat} gagne en efficacité et permet à l'algorithme de segmentation d'être mieux guidé.

Cependant l'absence de vérité-terrain à l'heure actuelle sur ces images ne permet pas d'évaluer quantitativement le gain réalisé grâce à l'emploi de la super-résolution.
Toutefois, une illustration est donnée par la représentation en 3D de la surface du cortex et de la surface de la matière blanche (voir Figure~\ref{FIG:COMPARE:HR:SR:3D}) dans le cas d'une image reconstruite selon les méthodes de \cite{Rousseau:AR:2006} et \cite{Rousseau:MIA:2010}.
Cet exemple montre que la super-résolution permet à l'algorithme de segmentation de mieux détecter les limites entre la matière blanche et le cortex. 

\subsubsection{Apparition des sillons corticaux au cours du temps}

\begin{figure}[!tb]
\centering
\subfigure[]{\includegraphics[height=39mm]{eps/chapitre4/DER_An_3D.eps}\label{DER:3D}}
\subfigure[]{\includegraphics[height=39mm]{eps/chapitre4/TAB_Ar_01_3D.eps}\label{TAB01:3D}} 
\subfigure[]{\includegraphics[height=39mm]{eps/chapitre4/AYD_Na_3D.eps}\label{AYD:3D}}  \\
\subfigure[]{\includegraphics[height=39mm]{eps/chapitre4/TAB_Ar_02_3D.eps}\label{TAB02:3D}} 
\subfigure[]{\includegraphics[height=39mm]{eps/chapitre4/HER_Au_3D.eps}\label{HER:3D}} 

\caption[\'Evolution des sillons corticaux au cours de la grossesse]{
\emph{\'Evolution des sillons corticaux au cours de la grossesse. Temps d'aménorrhée : (a) 26 semaines, (b) 27 semaines, (c) 28 semaines, (d) 30 semaines, (e) 32 semaines.}
\label{FIG:TIME:3D}}
% \vspace{-6mm}
\end{figure}

% La méthode de segmentation présentée dans ce chapitre donnant de bons résultats concernant l'évaluation de la surface du cortex, la base de données disponible permet de réaliser une observation de l'apparition des sillons corticaux au cours du temps.
La méthode de segmentation présentée au cours de ce chapitre permettant d'estimer la surface du cortex, il est alors possible de suivre l'évolution des sillons corticaux au cours des dernières semaines de grossesse.
Cinq cas, acquis à respectivement 26, 27, 28, 30 et 32 semaines sont présentés afin d'illustrer cette évolution.

La Figure~\ref{DER:3D} montre le cortex tel qu'il apparaît à 26 semaines d'aménorrhée.
Nous pouvons observer qu'à ce stade de la grossesse, seul l'\emph{insula}, le sillon latéral ainsi qu'une ébauche de sillon central sont observables. 
Par la suite, d'autres sillons viennent s'ajouter, marquant ainsi différentes étapes du développement du f\oe tus.
La Figure~\ref{TAB01:3D} montre l'apparition du sillon frontal supérieur et du sillon temporal supérieur sur un cas à 27 semaines d'aménorrhée.
Le développement du cerveau se poursuit pendant les semaines suivantes, marquée par l'apparition de nouveaux sillons, tels que le sillon postcentral et le sillon frontal inférieur comme illustré en Figure~\ref{TAB02:3D} (30 semaines d'aménorrhée).
Au cours des semaines suivantes, le cerveau continue de se complexifier, ce qui se matérialise par l'apparition de sillons secondaires, comme illustré par la Figure~\ref{HER:3D} (32 semaines d'aménorrhée).

On peut observer cependant que la Figure~\ref{AYD:3D} semble présenter un retard dans son développement, notamment vis-à-vis de la Figure~\ref{TAB01:3D}, qui à une semaine d'aménorrhée de moins présente une giration plus avancée.
Néanmoins, l'observation d'un tel écart dans le développement est tout à fait normal.
En effet, il est courant d'observer un écart de deux semaines entre l'apparition d'un sillon chez certains patients et sa présence dans 75\% des cas \cite{Glenn:SePer:2009}.
De manière générale, l'observation de l'apparition des sillons est conforme aux observations médicales. 

\section{Conclusion}

% Un prochaine étape pourrait être une détection des résidus de matrice germinale, ou l'affinement de la frontière entre le cortex et le LCR, ou entre le cortex et la matière blanche.
% et ainsi de reconstruire une frontière plus nette entre ces deux tissus et donc d'obtenir des résultats qui devraient permettre à terme de conduire des études sur l'épaisseur du cortex au cours de la grossesse.


Ce chapitre a présenté une méthode de segmentation du cortex en IRM f\oe tale.
Le principe est d'utiliser des \emph{a priori} anatomiques génériques sous forme de contraintes géométriques et de s'appuyer exclusivement sur les données de l'image pour obtenir la segmentation finale.
Les résultats obtenus montrent la pertinence de cette approche, notamment dans le cadre de cas bénéficiant de la reconstruction d'un volume 3D à partir des acquisitions originales.
Ils ouvrent la voie à des étapes additionnelles pour la segmentation des tissus cérébraux telles que la détection des résidus de la matrice germinale, l'affinement de la frontière entre le cortex et le LCR ou de celle entre le cortex et la matière blanche.
La meilleure netteté de la frontière entre le cortex et la matière blanche dans le cas d'images reconstruites par la méthode de super-résolution permet d'envisager l'étude de l'évolution de l'épaisseur corticale au cours de la grossesse.

Cependant, les contraintes géométriques du modèle, malgré leur apport dans la correction du volume partiel, introduisent des faux positifs dans la détection du cortex, notamment autour du tronc cérébral.
Le processus nécessite donc d'être fiabilisé en étant mieux guidé \emph{via} l'introduction d'\emph{a priori} supplémentaires.
Une piste de réflexion pourrait être de préciser qu'il n'y a pas de cortex au-dessus du tronc cérébral, ni autour des ventricules, permettant ainsi une adaptation des contraintes géométriques autour de ces structures.
Des méthodes formalisant les relations spatiales entre différents objets et exprimant leur position relative de façon floue existent~\cite{Bloch:IVC:2005} et semblent pouvoir être introduites dans le processus de segmentation.
% plusieurs limitations ne permettent pas d'utiliser cet algorithme en routine clinique ou pour des études de population.
% En effet, les coefficients de similarité obtenus, malgré leurs valeurs encourageantes, ne sont pas encore suffisamment élevés pour que la méthodologie présentée dans ce manuscrit puisse être utilisée de manière systématique.
Néanmoins, ce modèle semble suffisamment robuste pour pouvoir observer la surface du cortex ainsi que la surface de la matière blanche à la frontière du cortex et permet de suivre la formation des sillons corticaux, ce qui laisse penser qu'il est possible de mettre en \oe uvre un suivi automatique de leur formation et de leur développement au cours de la grossesse.

De plus, cette méthodologie s'appuie sur une extraction préalable du volume intracrânien et sur la segmentation du cervelet et du tronc cérébral.
La définition d'un outil d'extraction de ces structures est donc indispensable dans la perspective d'obtenir un processus automatique de segmentation complet des structures cérébrales.
